<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>米米的博客</title>
  
  <subtitle>做了一点微小的工作</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://zhangshuqiao.org/"/>
  <updated>2019-03-16T03:23:45.450Z</updated>
  <id>https://zhangshuqiao.org/</id>
  
  <author>
    <name>张书樵</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>神奇的求圆周率代码</title>
    <link href="https://zhangshuqiao.org/2019-03/%E7%A5%9E%E5%A5%87%E7%9A%84%E6%B1%82%E5%9C%86%E5%91%A8%E7%8E%87%E4%BB%A3%E7%A0%81/"/>
    <id>https://zhangshuqiao.org/2019-03/神奇的求圆周率代码/</id>
    <published>2019-03-14T07:09:26.000Z</published>
    <updated>2019-03-16T03:23:45.450Z</updated>
    
    <content type="html"><![CDATA[<p>今天是圆周率日，我们就来讲一讲关于圆周率的故事吧。<br>很久以前，博主看到了一段惊为天人的代码，可以求出圆周率的前800位（修改参数可以实现任意精度）：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a=<span class="number">10000</span>,b,c=<span class="number">2800</span>,d,e,f[<span class="number">2801</span>],g;main()&#123;<span class="keyword">for</span>(;b-c;)f[b++]=a/<span class="number">5</span>;</span><br><span class="line"><span class="keyword">for</span>(;d=<span class="number">0</span>,g=c*<span class="number">2</span>;c-=<span class="number">14</span>,<span class="built_in">printf</span>(<span class="string">"%.4d"</span>,e+d/a),e=d%a)<span class="keyword">for</span>(b=c;d+=f[b]*a,</span><br><span class="line">f[b]=d%--g,d/=g--,--b;d*=b);&#125;</span><br></pre></td></tr></table></figure></p><p><a href="https://crypto.stanford.edu/pbc/notes/pi/code.html" target="_blank" rel="noopener">经过考证</a>，这段代码的作者是Dik T. Winter。下面我们来看看它是如何工作的。</p><p>在C语言中，<code>for</code>循环和<code>while</code>循环可以互相代替。这里涉及到<code>for</code>循环的执行顺序。例如<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (statement1; statement2; statement3) &#123;</span><br><span class="line">    statements;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>上面的<code>for</code>语句可以用下面的<code>while</code>语句来代替：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">statement1;</span><br><span class="line"><span class="keyword">while</span> (statement2) &#123;</span><br><span class="line">    statements;</span><br><span class="line">    statement3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>而逗号运算符和<code>--</code>运算符的功能也是需要注意的。要写出这样怪异的C程序，逗号运算符无疑是一个好的助手，它的作用是：从左到右依次计算各个表达式的值，并且返回最右边表达式的值。</p><p>了解这些内容后，我们将这段代码中的<code>for</code>循环展开，等价地写为<code>while</code>的形式。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> a = <span class="number">10000</span>, b, c = <span class="number">2800</span>, d, e, f[<span class="number">2801</span>], g;</span><br><span class="line">main() &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; c; i++) &#123;</span><br><span class="line">        f[i] = a / <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (c != <span class="number">0</span>) &#123;</span><br><span class="line">        d = <span class="number">0</span>;</span><br><span class="line">        g = c * <span class="number">2</span>;</span><br><span class="line">        b = c;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            d += f[b] * a;</span><br><span class="line">            g--;</span><br><span class="line">            f[b] = d % g;</span><br><span class="line">            d /= g;</span><br><span class="line">            g--;</span><br><span class="line">            b--;</span><br><span class="line">            <span class="keyword">if</span> (b == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            d *= b;</span><br><span class="line">        &#125;</span><br><span class="line">        c -= <span class="number">14</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%.4d"</span>, e + d / a);</span><br><span class="line">        e = d % a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><a id="more"></a><p>进一步观察，不难发现这里的<code>a</code>是常数，而<code>g</code>可以方便的代换掉。继续改写代码。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> b, c = <span class="number">2800</span>, d, e, f[<span class="number">2801</span>]; </span><br><span class="line">main() &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; c; i++) &#123;</span><br><span class="line">        f[i] = <span class="number">2000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (c != <span class="number">0</span>) &#123;</span><br><span class="line">        b = c;</span><br><span class="line">        d = f[b] * <span class="number">10000</span>;</span><br><span class="line">        f[b] = d % (b * <span class="number">2</span> - <span class="number">1</span>);</span><br><span class="line">        d /= b * <span class="number">2</span> - <span class="number">1</span>;</span><br><span class="line">        b--;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            d = d * b + f[b] * <span class="number">10000</span>;</span><br><span class="line">            f[b] = d % (b * <span class="number">2</span> - <span class="number">1</span>);</span><br><span class="line">            d = d / (b * <span class="number">2</span> - <span class="number">1</span>);</span><br><span class="line">            b--;</span><br><span class="line">            <span class="keyword">if</span> (b == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        c -= <span class="number">14</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%.4d"</span>, e + d / <span class="number">10000</span>);</span><br><span class="line">        e = d % <span class="number">10000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>不过，即使是这样，这段代码还是让人看得很迷糊。我们不妨开个挂，进行倒推吧。<br>我们来看看这段代码的数学对应。这是一个计算$\pi$的公式：<br>$$\frac{\pi}{2}=\sum_{k=0}^{\infty}\frac{k!}{(2k+1)!!}=\sum_{k=0}^{\infty}\frac{2^{k}k!^{2}}{(2k+1)!}=1+\frac{1}{3}\left(1+\frac{2}{5}\left(1+\frac{3}{7}(1+\cdots)\right)\right)$$<br>可以进一步写为<br>$$\pi=2\left(1+\frac{1}{3}\left(1+\frac{2}{5}\left(1+…\left(1+\frac{2799}{2\cdot2799+1}(1+0)\right)…\right)\right)\right)$$<br>根据维基百科的相关内容，该公式最早似乎由牛顿推出，而Wolfram收录的一个变式则写明作者是Beeler等人。参见<a href="http://mathworld.wolfram.com/PiFormulas.html" target="_blank" rel="noopener">PiFormulas</a>。<br>在这个迭代中，我们需要不断地生成形如$\frac{k}{2k+1}$的分式。对应于展开后的代码，不难发现<code>g</code>就是分母，而<code>b</code>则是分子。<br>当然，这还不是足够的。一个重要的问题是如何在逐次迭代中将误差进行传递，以实现任意精度的计算。整个程序中的唯一一个关系到输出的<code>printf</code>函数，每次会输出四位整数。那么<code>c -= 14</code>又是怎么来的呢？我们注意到$2^{14}&gt;10^4=10000$，而$14\times 200=2800$，$200\times 4=800$，这些『神秘数字』就都说得通了。每次循环用14项获得4位精确的$\pi$值，它们是一个八位整数的前四位，因此需要模10000；然后将后四位乘以10000，代入下一次循环。</p><p>读者可以自行体会这个算法的精妙，特别是它是如何在不损失精度的情况下，完成整个计算过程。</p><hr><p>参考文章：<br><a href="https://crypto.stanford.edu/pbc/notes/pi/code.html" target="_blank" rel="noopener">Computing Pi in C</a><br><a href="http://www.cnblogs.com/PegasusWang/archive/2013/03/17/2965189.html" target="_blank" rel="noopener">求圆周率Pi一万位程序分析</a></p><p>拓展阅读：<br><a href="https://blog.csdn.net/s170262941/article/details/11123945" target="_blank" rel="noopener">编程计算Pi的N种方法</a><br><a href="http://numbers.computation.free.fr/Constants/TinyPrograms/tinycodes.html" target="_blank" rel="noopener">Tiny programs for constants computation</a><br><a href="https://zh.wikipedia.org/wiki/圓周率" target="_blank" rel="noopener">圓周率 - 维基百科</a><br><a href="https://zh.wikipedia.org/wiki/圆周率近似值" target="_blank" rel="noopener">圆周率近似值 - 维基百科</a><br><a href="https://zh.wikipedia.org/wiki/梅欽類公式" target="_blank" rel="noopener">梅欽類公式 - 维基百科</a><br><a href="http://www.angio.net/pi/" target="_blank" rel="noopener">The Pi-Search Page</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;今天是圆周率日，我们就来讲一讲关于圆周率的故事吧。&lt;br&gt;很久以前，博主看到了一段惊为天人的代码，可以求出圆周率的前800位（修改参数可以实现任意精度）：&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; a=&lt;span class=&quot;number&quot;&gt;10000&lt;/span&gt;,b,c=&lt;span class=&quot;number&quot;&gt;2800&lt;/span&gt;,d,e,f[&lt;span class=&quot;number&quot;&gt;2801&lt;/span&gt;],g;main()&amp;#123;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(;b-c;)f[b++]=a/&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(;d=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,g=c*&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;c-=&lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;,&lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;%.4d&quot;&lt;/span&gt;,e+d/a),e=d%a)&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(b=c;d+=f[b]*a,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;f[b]=d%--g,d/=g--,--b;d*=b);&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://crypto.stanford.edu/pbc/notes/pi/code.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;经过考证&lt;/a&gt;，这段代码的作者是Dik T. Winter。下面我们来看看它是如何工作的。&lt;/p&gt;
&lt;p&gt;在C语言中，&lt;code&gt;for&lt;/code&gt;循环和&lt;code&gt;while&lt;/code&gt;循环可以互相代替。这里涉及到&lt;code&gt;for&lt;/code&gt;循环的执行顺序。例如&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (statement1; statement2; statement3) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    statements;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;上面的&lt;code&gt;for&lt;/code&gt;语句可以用下面的&lt;code&gt;while&lt;/code&gt;语句来代替：&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;statement1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (statement2) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    statements;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    statement3;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;而逗号运算符和&lt;code&gt;--&lt;/code&gt;运算符的功能也是需要注意的。要写出这样怪异的C程序，逗号运算符无疑是一个好的助手，它的作用是：从左到右依次计算各个表达式的值，并且返回最右边表达式的值。&lt;/p&gt;
&lt;p&gt;了解这些内容后，我们将这段代码中的&lt;code&gt;for&lt;/code&gt;循环展开，等价地写为&lt;code&gt;while&lt;/code&gt;的形式。&lt;br&gt;&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; a = &lt;span class=&quot;number&quot;&gt;10000&lt;/span&gt;, b, c = &lt;span class=&quot;number&quot;&gt;2800&lt;/span&gt;, d, e, f[&lt;span class=&quot;number&quot;&gt;2801&lt;/span&gt;], g;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;main() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; c; i++) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        f[i] = a / &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (c != &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        d = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        g = c * &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        b = c;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            d += f[b] * a;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            g--;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            f[b] = d % g;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            d /= g;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            g--;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            b--;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (b == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            d *= b;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        c -= &lt;span class=&quot;number&quot;&gt;14&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;%.4d&quot;&lt;/span&gt;, e + d / a);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        e = d % a;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="程序设计" scheme="https://zhangshuqiao.org/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
    
      <category term="C" scheme="https://zhangshuqiao.org/tags/C/"/>
    
      <category term="数学" scheme="https://zhangshuqiao.org/tags/%E6%95%B0%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>真正的红黑树</title>
    <link href="https://zhangshuqiao.org/2019-03/%E7%9C%9F%E6%AD%A3%E7%9A%84%E7%BA%A2%E9%BB%91%E6%A0%91/"/>
    <id>https://zhangshuqiao.org/2019-03/真正的红黑树/</id>
    <published>2019-03-04T16:17:14.000Z</published>
    <updated>2019-03-12T03:55:34.959Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/2019-03/IMG_4171.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/2019-03/IMG_4171.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;

      
    
    </summary>
    
      <category term="幽默" scheme="https://zhangshuqiao.org/categories/%E5%B9%BD%E9%BB%98/"/>
    
    
  </entry>
  
  <entry>
    <title>macOS Mojave动态壁纸</title>
    <link href="https://zhangshuqiao.org/2019-02/macOS%20Mojave%E5%8A%A8%E6%80%81%E5%A3%81%E7%BA%B8/"/>
    <id>https://zhangshuqiao.org/2019-02/macOS Mojave动态壁纸/</id>
    <published>2019-02-26T00:33:12.000Z</published>
    <updated>2019-03-04T05:24:44.609Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/2019-02/1_qjVGv0IMNTeKFIcks41ohA.png" alt=""></p><p>How Apple built dynamic wallpapers? And is it possible to create your own dynamic wallpaper for macOS? I spent some time because I would like to answer to the both above questions.<br>Apple如何构建动态壁纸？是否可以为macOS创建自己的动态壁纸？我花了一些时间，因为我想回答上述两个问题。</p><hr><p>In Mojave we can choose new type of wallpaper: dynamic.<br>在Mojave，我们可以选择新型壁纸：动态。</p><p><img src="/images/2019-02/1_4a3SZs7wS3g3AtO8E2RNvw.png" alt=""></p><p>Depending on day time, system displays different wallpaper. At night it is picture of Mojave at night, during day it’s picture of Mojave taken during day. So at night we have dark wallpaper at day we have light wallpaper.<br>根据时间，系统会显示不同的壁纸。晚上显示Mojave晚上的照片，白天则是在白天拍摄的Mojave的照片。所以晚上我们有暗色的壁纸，白天则是明亮的壁纸。</p><p>All built in wallpapers in macOS we can find in folder: <code>/Library/Desktop Pictures</code>. Also here we can find dynamic wallpaper.<br>我们可以在文件夹<code>/Library/Desktop Pictures</code>中找到所有macOS内置的壁纸。在这里我们也可以找到动态壁纸。</p><p><img src="/images/2019-02/1_lRpwIxzeyEoXMbz97ZfG5Q.png" alt=""></p><p>Dynamic wallpaper is saved as a HEIC file (<code>Mojave (Dynamic).heic</code>). More information about this type of file you can find on <a href="https://en.wikipedia.org/wiki/High_Efficiency_Image_File_Format" target="_blank" rel="noopener">Wikipedia</a>. Generally this is type of file which Apple uses in iOS devices. Photos in iOS (also live photos) are stored as a HEIC file. That kind of file can contains multiple images/thumbnails and metadata in a single file.<br>动态壁纸保存为HEIC文件（<code>Mojave (Dynamic).heic</code>）。有关此类文件的更多信息，请访问<a href="https://en.wikipedia.org/wiki/High_Efficiency_Image_File_Format" target="_blank" rel="noopener">Wikipedia</a>。通常，这是Apple在iOS设备中使用的文件类型。iOS中的照片（也包括实时照片）会存储为HEIC文件。这种文件可以在单个文件中包含多个图像/缩略图和元数据。</p><p>There is really good online tool where we can check content of Mojave wallpaper file: <a href="https://strukturag.github.io/libheif/" target="_blank" rel="noopener">https://strukturag.github.io/libheif/</a>. You can upload <code>Mojave (Dynamic).heic</code> file and you will see that in this single file there is 16 separate pictures taken in different day phase.<br>有一个很好的在线工具，让我们可以检查Mojave壁纸文件的内容：<a href="https://strukturag.github.io/libheif/" target="_blank" rel="noopener">https://strukturag.github.io/libheif/</a> 。你可以上传<code>Mojave (Dynamic).heic</code>文件，然后你会发现在这个单独的文件中有16张不同时间拍摄的单独照片。</p><p><img src="/images/2019-02/1_ESDAv949YKQIEocL-qDcGA.png" alt=""></p><p>So maybe it’s enough to create new HEIC file with 16 separate images and macOS will show them properly. Let’s try it!<br>所以也许它足以创建具有16个单独图像的新HEIC文件，macOS将正确显示它们。我们来试试吧！</p><a id="more"></a><p>First I had to prepare 16 different images.<br>首先，我必须准备16张不同的图像。</p><p><img src="/images/2019-02/1_VBLUh9q7ygeysmHmCPr7tQ.png" alt=""></p><p>I know, I know - they are not impressive :-). However for our experiment they will be enough.<br>我知道，我知道 - 它们非常trivial :-)。然而，对于我们的实验，它们就足够了。</p><p>Now I have to prepare application which convert set of images to one HEIC file. I prepared simple console application in Swift.<br>现在我必须准备一个能将图像集转换为HEIC文件的应用程序。我用Swift写了一个简单的控制台应用程序。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> AppKit</span><br><span class="line"><span class="keyword">import</span> AVFoundation</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSImage</span> </span>&#123;</span><br><span class="line">    <span class="meta">@objc</span> <span class="keyword">var</span> <span class="type">CGImage</span>: <span class="type">CGImage</span>? &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> imageData = <span class="keyword">self</span>.tiffRepresentation <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> sourceData = <span class="type">CGImageSourceCreateWithData</span>(imageData <span class="keyword">as</span> <span class="type">CFData</span>, <span class="literal">nil</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">CGImageSourceCreateImageAtIndex</span>(sourceData, <span class="number">0</span>, <span class="literal">nil</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> output = <span class="string">"wallpapers-new/output.heic"</span></span><br><span class="line"><span class="keyword">let</span> quality = <span class="number">0.9</span></span><br><span class="line"><span class="keyword">var</span> imageData: <span class="type">Data</span>? = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> dir = <span class="type">FileManager</span>.<span class="keyword">default</span>.urls(<span class="keyword">for</span>: .documentDirectory, <span class="keyword">in</span>: .userDomainMask).first &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> destinationData = <span class="type">NSMutableData</span>()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> destination = <span class="type">CGImageDestinationCreateWithData</span>(destinationData, <span class="type">AVFileType</span>.heic <span class="keyword">as</span> <span class="type">CFString</span>, <span class="number">16</span>, <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> options = [kCGImageDestinationLossyCompressionQuality: quality]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">1</span>...<span class="number">16</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> fileURL = dir.appendingPathComponent(<span class="string">"wallpapers-new/\(index).png"</span>)</span><br><span class="line">            <span class="keyword">let</span> orginalImage = <span class="type">NSImage</span>(contentsOf: fileURL)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> cgImage = orginalImage?.<span class="type">CGImage</span> &#123;</span><br><span class="line">                    <span class="type">CGImageDestinationAddImage</span>(destination, cgImage, options <span class="keyword">as</span> <span class="type">CFDictionary</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">CGImageDestinationFinalize</span>(destination)</span><br><span class="line">        imageData = destinationData <span class="keyword">as</span> <span class="type">Data</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> outputURL = dir.appendingPathComponent(output)</span><br><span class="line">        <span class="keyword">try</span>! imageData?.write(to: outputURL)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Application requires that in my <code>Documents</code> folder I have <code>wallpaper-new</code> folder with 16 images (from <code>1.png</code> to <code>16.png</code>). I can run application and after that I have new <code>output.heic</code> file in the same directory.<br>应用程序要求在我的<code>Documents</code>文件夹中存在有<code>wallpaper-new</code>文件夹，里面有16张图片（从<code>1.png</code>到<code>16.png</code>）。我可以运行应用程序，之后我在同一目录中有了新的<code>output.heic</code>文件。</p><p>After setting this file as a wallpaper I had only one image displayed during whole day. So it seems that this file have to contains something extra. I decided to check what metadata is inside original Mojave wallpaper. I downloaded <a href="https://github.com/strukturag/libheif" target="_blank" rel="noopener">libheif</a> library (I modified a little bit <code>heif-info</code> application) and I’ve got below result:<br>将此文件设置为壁纸后，我在一整天中只显示了一个图像。所以似乎这个文件必须包含额外的东西。我决定检查原始Mojave壁纸中的元数据。我下载了<a href="https://github.com/strukturag/libheif" target="_blank" rel="noopener">libheif</a>库（修改了一下<code>heif-info</code>应用程序），然后得到了以下结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">Number of top level images: 16</span><br><span class="line">    image <span class="comment">#0</span></span><br><span class="line">        id: 61</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br><span class="line">        is primary: yes</span><br><span class="line">        number of metadata: 1</span><br><span class="line">        metadata <span class="built_in">type</span>: mime</span><br><span class="line">        content <span class="built_in">type</span>: application/rdf+xml</span><br><span class="line">        metadata size: 3302</span><br><span class="line">        metadata content:</span><br><span class="line"></span><br><span class="line">&lt;?xpacket begin=<span class="string">""</span> id=<span class="string">"W5M0MpCehiHzreSzNTczkc9d"</span>?&gt; &lt;x:xmpmeta xmlns:x=<span class="string">"adobe:ns:meta/"</span> x:xmptk=<span class="string">"XMP Core 5.4.0"</span>&gt; &lt;rdf:RDF xmlns:rdf=<span class="string">"http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span>&gt; &lt;rdf:Description rdf:about=<span class="string">""</span> xmlns:apple_desktop=<span class="string">"http://ns.apple.com/namespace/1.0/"</span> apple_desktop:solar=<span class="string">"YnBsaXN0MDDRAQJSc2mvEBADDBAUGBwgJCgsMDQ4PEFF1AQFBgcICQoLUWlRelFhUW8QACNAcO7vOubr3yO/1e+pmkOtXBAB1AQFBgcNDg8LEAEjQFRxqCKOFiAjwCR6waUkDgHUBAUGBxESEwsQAiNAVZV4BI4c+CPAEP2uFrMcrdQEBQYHFRYXCxADI0BWtALKmrjwIz/2ObLnx6l21AQFBgcZGhsLEAQjQFfTrJlEjnwjQByrLle1Q0rUBAUGBx0eHwsQBSNAWPrrmI0ISCNAKiwhpSRpc9QEBQYHISIjCxAGI0BgJff9KDpyI0BENTOsilht1AQFBgclJicLEAcjQGbHdYIVQKojQEq3fAg86lXUBAUGBykqKwsQCCNAbTGmpC2YRiNAQ2WFOZGjntQEBQYHLS4vCxAJI0BwXfII2B+SI0AmLcjfuC7g1AQFBgcxMjMLEAojQHCnF6YrsxcjQBS9AVBLTq3UBAUGBzU2NwsQCyNAcTcSnimmjCPAGP5E0ASXJtQEBQYHOTo7CxAMI0BxgSADjxK2I8AoalieOTyE1AQFBgc9Pj9AEA0jQHNWsnnMcWIjwEO+oq1pXr8QANQEBQYHQkNEQBAOI0ABZpkFpAcAI8BKYGg/VvMf1AQFBgdGR0hAEA8jQErBKblRzPgjwEMGElBIUO0ACAALAA4AIQAqACwALgAwADIANAA9AEYASABRAFMAXABlAG4AcAB5AIIAiwCNAJYAnwCoAKoAswC8AMUAxwDQANkA4gDkAO0A9gD/AQEBCgETARwBHgEnATABOQE7AUQBTQFWAVgBYQFqAXMBdQF+AYcBkAGSAZsBpAGtAa8BuAHBAcMBzAHOAdcB4AHpAesB9AAAAAAAAAIBAAAAAAAAAEkAAAAAAAAAAAAAAAAAAAH9"</span>/&gt; &lt;/rdf:RDF&gt; &lt;/x:xmpmeta&gt;&lt;?xpacket end=<span class="string">"w"</span>?&gt;</span><br><span class="line"></span><br><span class="line">    image <span class="comment">#1</span></span><br><span class="line">        id: 123</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br><span class="line">    image <span class="comment">#2</span></span><br><span class="line">        id: 184</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br><span class="line">    image <span class="comment">#3</span></span><br><span class="line">        id: 245</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br><span class="line">    image <span class="comment">#4</span></span><br><span class="line">        id: 306</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br><span class="line">    image <span class="comment">#5</span></span><br><span class="line">        id: 367</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br><span class="line">    image <span class="comment">#6</span></span><br><span class="line">        id: 428</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br><span class="line">    image <span class="comment">#7</span></span><br><span class="line">        id: 489</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br><span class="line">    image <span class="comment">#8</span></span><br><span class="line">        id: 550</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br><span class="line">    image <span class="comment">#9</span></span><br><span class="line">        id: 611</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br><span class="line">    image <span class="comment">#10</span></span><br><span class="line">        id: 672</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br><span class="line">    image <span class="comment">#11</span></span><br><span class="line">        id: 733</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br><span class="line">    image <span class="comment">#12</span></span><br><span class="line">        id: 794</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br><span class="line">    image <span class="comment">#13</span></span><br><span class="line">        id: 855</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br><span class="line">    image <span class="comment">#14</span></span><br><span class="line">        id: 916</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br><span class="line">    image <span class="comment">#15</span></span><br><span class="line">        id: 977</span><br><span class="line">        width: 5120</span><br><span class="line">        height: 2880</span><br></pre></td></tr></table></figure></p><p>Thus we can see that in the first image we have additional <a href="https://www.adobe.com/products/xmp.html" target="_blank" rel="noopener">XMP metadata</a>. Now I know that I have to modify a little bit my Swift application. It should also add metadata for the first image in the sequence.<br>因此，我们可以看到在第一张图片中我们有额外的<a href="https://www.adobe.com/products/xmp.html" target="_blank" rel="noopener">XMP元数据</a>。现在我知道我必须修改一下我的Swift应用程序。它还应该为序列中的第一个图像添加元数据。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> AppKit</span><br><span class="line"><span class="keyword">import</span> AVFoundation</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">NSImage</span> </span>&#123;</span><br><span class="line">    <span class="meta">@objc</span> <span class="keyword">var</span> <span class="type">CGImage</span>: <span class="type">CGImage</span>? &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> imageData = <span class="keyword">self</span>.tiffRepresentation <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> sourceData = <span class="type">CGImageSourceCreateWithData</span>(imageData <span class="keyword">as</span> <span class="type">CFData</span>, <span class="literal">nil</span>) <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">CGImageSourceCreateImageAtIndex</span>(sourceData, <span class="number">0</span>, <span class="literal">nil</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> output = <span class="string">"wallpapers-new/output.heic"</span></span><br><span class="line"><span class="keyword">let</span> quality = <span class="number">0.9</span></span><br><span class="line"><span class="keyword">var</span> imageData: <span class="type">Data</span>? = <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> dir = <span class="type">FileManager</span>.<span class="keyword">default</span>.urls(<span class="keyword">for</span>: .documentDirectory, <span class="keyword">in</span>: .userDomainMask).first &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> destinationData = <span class="type">NSMutableData</span>()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> destination = <span class="type">CGImageDestinationCreateWithData</span>(destinationData, <span class="type">AVFileType</span>.heic <span class="keyword">as</span> <span class="type">CFString</span>, <span class="number">16</span>, <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> options = [kCGImageDestinationLossyCompressionQuality: quality]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> <span class="number">1</span>...<span class="number">16</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> fileURL = dir.appendingPathComponent(<span class="string">"wallpapers-new/\(index).png"</span>)</span><br><span class="line">            <span class="keyword">let</span> orginalImage = <span class="type">NSImage</span>(contentsOf: fileURL)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> cgImage = orginalImage?.<span class="type">CGImage</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> index == <span class="number">1</span> &#123;</span><br><span class="line">                    <span class="keyword">let</span> imageMetadata = <span class="type">CGImageMetadataCreateMutable</span>()</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">let</span> imageMetadataTag = <span class="type">CGImageMetadataTagCreate</span>(<span class="string">"http://ns.apple.com/namespace/1.0/"</span> <span class="keyword">as</span> <span class="type">CFString</span>, </span><br><span class="line">                                                                    <span class="string">"apple_desktop"</span> <span class="keyword">as</span> <span class="type">CFString</span>, </span><br><span class="line">                                                                    <span class="string">"solar"</span> <span class="keyword">as</span> <span class="type">CFString</span>, </span><br><span class="line">                                                                    <span class="type">CGImageMetadataType</span>.string, </span><br><span class="line">                                                                    <span class="string">"YnBsaXN0MDDRAQJSc2mvEBADDBAUGBwgJCgsMDQ4PEFF1AQFB"</span> +</span><br><span class="line">                                                                    <span class="string">"gcICQoLUWlRelFhUW8QACNAcO7vOubr3yO/1e+pmkOtXBAB1A"</span> +</span><br><span class="line">                                                                    <span class="string">"QFBgcNDg8LEAEjQFRxqCKOFiAjwCR6waUkDgHUBAUGBxESEws"</span> +</span><br><span class="line">                                                                    <span class="string">"QAiNAVZV4BI4c+CPAEP2uFrMcrdQEBQYHFRYXCxADI0BWtALK"</span> +</span><br><span class="line">                                                                    <span class="string">"mrjwIz/2ObLnx6l21AQFBgcZGhsLEAQjQFfTrJlEjnwjQByrL"</span> +</span><br><span class="line">                                                                    <span class="string">"le1Q0rUBAUGBx0eHwsQBSNAWPrrmI0ISCNAKiwhpSRpc9QEBQ"</span> +</span><br><span class="line">                                                                    <span class="string">"YHISIjCxAGI0BgJff9KDpyI0BENTOsilht1AQFBgclJicLEAc"</span> +</span><br><span class="line">                                                                    <span class="string">"jQGbHdYIVQKojQEq3fAg86lXUBAUGBykqKwsQCCNAbTGmpC2Y"</span> +</span><br><span class="line">                                                                    <span class="string">"RiNAQ2WFOZGjntQEBQYHLS4vCxAJI0BwXfII2B+SI0AmLcjfu"</span> +</span><br><span class="line">                                                                    <span class="string">"C7g1AQFBgcxMjMLEAojQHCnF6YrsxcjQBS9AVBLTq3UBAUGBz"</span> +</span><br><span class="line">                                                                    <span class="string">"U2NwsQCyNAcTcSnimmjCPAGP5E0ASXJtQEBQYHOTo7CxAMI0B"</span> +</span><br><span class="line">                                                                    <span class="string">"xgSADjxK2I8AoalieOTyE1AQFBgc9Pj9AEA0jQHNWsnnMcWIj"</span> +</span><br><span class="line">                                                                    <span class="string">"wEO+oq1pXr8QANQEBQYHQkNEQBAOI0ABZpkFpAcAI8BKYGg/V"</span> +</span><br><span class="line">                                                                    <span class="string">"vMf1AQFBgdGR0hAEA8jQErBKblRzPgjwEMGElBIUO0ACAALAA"</span> +</span><br><span class="line">                                                                    <span class="string">"4AIQAqACwALgAwADIANAA9AEYASABRAFMAXABlAG4AcAB5AII"</span> +</span><br><span class="line">                                                                    <span class="string">"AiwCNAJYAnwCoAKoAswC8AMUAxwDQANkA4gDkAO0A9gD/AQEB"</span> +</span><br><span class="line">                                                                    <span class="string">"CgETARwBHgEnATABOQE7AUQBTQFWAVgBYQFqAXMBdQF+AYcBk"</span> +</span><br><span class="line">                                                                    <span class="string">"AGSAZsBpAGtAa8BuAHBAcMBzAHOAdcB4AHpAesB9AAAAAAAAA"</span> +</span><br><span class="line">                                                                    <span class="string">"IBAAAAAAAAAEkAAAAAAAAAAAAAAAAAAAH9"</span> <span class="keyword">as</span> <span class="type">CFTypeRef</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">let</span> success = <span class="type">CGImageMetadataSetTagWithPath</span>(imageMetadata, <span class="literal">nil</span>, <span class="string">"xmp:solar"</span> <span class="keyword">as</span> <span class="type">CFString</span>, imageMetadataTag!)</span><br><span class="line">                    <span class="keyword">if</span> !success &#123;</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">"Error!!!"</span>)</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="type">CGImageDestinationAddImageAndMetadata</span>(destination, cgImage, imageMetadata, options <span class="keyword">as</span> <span class="type">CFDictionary</span>)</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">CGImageDestinationAddImage</span>(destination, cgImage, options <span class="keyword">as</span> <span class="type">CFDictionary</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">CGImageDestinationFinalize</span>(destination)</span><br><span class="line">        imageData = destinationData <span class="keyword">as</span> <span class="type">Data</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> outputURL = dir.appendingPathComponent(output)</span><br><span class="line">        <span class="keyword">try</span>! imageData?.write(to: outputURL)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Now we can set up our new file as a wallpaper. And this is the result:<br>现在我们可以将新文件设置为壁纸。这就是结果：<br><a href="https://www.youtube.com/watch?v=_r0Qxblyz8U" target="_blank" rel="noopener">https://www.youtube.com/watch?v=_r0Qxblyz8U</a></p><p><strong>It works!</strong> We can prepare our custom dynamic wallpaper! And it’s pretty easy.<br><strong>它是有效的！</strong>我们可以准备我们的自定义动态壁纸！这很容易。</p><hr><p>Now the question is: what is in the <code>apple_desktop:solar</code> attribute? It seems that this is something encoded in base64. We can save value of that attribute as a text file (e.g. <code>text.base64</code>) and run following command:<br>现在的问题是：<code>apple_desktop：solar</code>属性是什么？似乎这是base64编码的东西。我们可以将该属性的值保存为文本文件（例如<code>text.base64</code>）并运行以下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base64 -D text.base64 -o decoded.txt</span><br></pre></td></tr></table></figure></p><p>After opening <code>decoded.txt</code> file we can notice that it starts from: <code>bplist00</code>. So it seems that it’s binary <code>plist</code> file. We can run next command:<br>打开<code>decoding.txt</code>文件后，我们可以注意到它从<code>bplist00</code>开始。所以它似乎是二进制<code>plist</code>文件。我们可以运行下一个命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plutil -convert xml1 decoded.txt</span><br></pre></td></tr></table></figure></p><p>And now in <code>decoded.txt</code> file we have XML with data which was prepared by Apple.<br>现在在<code>decoding.txt</code>文件中，我们拥有由Apple准备的XML数据。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">key</span>&gt;</span>si<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>-0.34275283875350282<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>0<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>270.9334057827345<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>-10.239758644725045<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>81.775887144809985<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>-4.2477344080754564<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>2<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>86.33545030477751<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>1.3890866331008431<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>3<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>90.812670374961954<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>7.167168970526129<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>4<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>95.307409588765893<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>13.08619419164163<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>5<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>99.920629632689383<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>40.415639464904281<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>6<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>129.18652208191958<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>53.433472661727741<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>7<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>182.23309425497911<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>38.793128200638634<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>8<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>233.55159195809591<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>11.089423171265878<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>9<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>261.87159046576664<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>5.1845753236736245<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>10<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>266.44327370710511<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>-6.2483093741227886<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>11<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>275.44204536695247<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>-12.20770735214888<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>12<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>280.07031589401174<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>-39.48933951993012<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>13<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>0<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>309.41857318745144<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>-52.753181378799347<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>14<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>0<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>2.1750965538675473<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>-38.04743388682423<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>15<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>0<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>53.509085812513092<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>We have 16 <code>dict</code> elements (one for each image) with four keys:<br>我们有16个<code>dict</code>元素（每个图像一个），有四个键：</p><ul><li>a - (probably) some time marker<br>a - （可能）一些时间标记</li><li>i - image index<br>i - 图像索引</li><li>o - ? (in current Mojave wallpaper it is always equal 0)<br>o - ？（在当前的Mojave壁纸中它始终等于0）</li><li>z - some time marker<br>z - 一些时间标记</li></ul><p>Unfortunately I don’t know yet how to convert above float numbers to time markers. If you have some ideas please let me know. Then I will have all mandatory pieces to build macOS application which based on chosen files will generate dynamic wallpaper.<br>不幸的是我还不知道如何将浮点数转换为时间标记。如果您有任何想法，请告诉我。然后我将有所有强制性的部分来构建基于所选文件的macOS应用程序将生成动态壁纸。</p><p>For now I can build only wallpaper which will behave exactly the same way like Apple’s wallpaper.<br>现在我只能制作壁纸，其行为与Apple的壁纸完全相同。</p><hr><p><img src="/images/2019-02/1_YU1DYB5fNiLZnqjKQCxI-Q.png" alt=""></p><p>In my previous article I described how dynamic wallpapers works. I didn’t know then what some of the properties in metadata means. I asked if somebody else knows what that properties means, and I’ve got a response really quickly. On Twitter @zwaldowski wrote to me explanation what all properties stands for.<br>在我的上一篇文章中，我描述了动态壁纸的工作原理。我不知道元数据中的某些属性意味着什么。我问其他人是否知道这些属性意味着什么，而且我很快得到了答复。在Twitter上@zwaldowski给我写了解释所有属性的含义。</p><p><img src="/images/2019-02/1_Q4Uu6sT5PufFzDOxgAI9XQ.png" alt=""></p><p>Thus, as I wrote previously, in HEIC file we have metadata which looks like on below snippet.<br>因此，正如我之前所写，在HEIC文件中，我们有一些元数据，如下面的代码片段所示。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">key</span>&gt;</span>si<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>a<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>-0.34275283875350282<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>i<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>0<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>o<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">integer</span>&gt;</span>1<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>z<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">real</span>&gt;</span>270.9334057827345<span class="tag">&lt;/<span class="name">real</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>We have 16 <code>dict</code> elements (one for each image) with four keys:<br>我们有16个<code>dict</code>元素（每个图像一个），有四个键：</p><ul><li>a - altitude<br>a - 海拔高度</li><li>i - image index<br>i - 图像索引</li><li>o - indicates in which desktop theme image should be displayed. 0 - displays in both mode (light/dark). 1 - displays only in light mode.<br>o - 表示应显示哪个桌面主题图像。0 - 以两种模式（亮/暗）显示。1 - 仅在灯光模式下显示。</li><li>z - azimuth<br>z - 方位角</li></ul><p>Thanks to <a href="https://en.wikipedia.org/wiki/Horizontal_coordinate_system" target="_blank" rel="noopener">altitude and azimuth</a> w exactly know where the Sun was when image was taken.<br>感谢<a href="https://en.wikipedia.org/wiki/Horizo​​ntal_coordinate_system" target="_blank" rel="noopener">海拔高度和方位角</a>，可以确切知道拍摄图像时太阳的位置。</p><p><img src="/images/2019-02/1_yhrXm56MaqMLfRLYTWaTtw.png" alt=""></p><p>This idea is brilliant, because thanks to this information macOS can change images differently during Summer and during Winter. System knows where the Sun is and it will choose image which was taken in similar conditions. <strong>Brilliant</strong>.<br>这个想法很棒，因为由于这些信息，macOS可以在夏季和冬季期间以不同方式更改图像。系统知道太阳在哪里，它将选择在类似条件下拍摄的图像。<strong>太机智了</strong>。</p><hr><p>Based on that knowledge I prepared new dynamic wallpaper. Here is the video how it looks like:<br>基于这些知识，我准备了新的动态壁纸。以下是视频：<br><a href="https://www.youtube.com/watch?v=TVqfPzdsbzY" target="_blank" rel="noopener">https://www.youtube.com/watch?v=TVqfPzdsbzY</a></p><p>You can download that wallpaper from my Dropbox:<br>你可以从我的Dropbox下载这个壁纸：<br><a href="https://www.dropbox.com/s/kd2g59qswchsd0v/Earth%20View.heic?dl=0" target="_blank" rel="noopener">https://www.dropbox.com/s/kd2g59qswchsd0v/Earth%20View.heic?dl=0</a></p><p>Thank you for your help and feedback!<br>感谢您的帮助和反馈！</p><hr><p><strong>Update:</strong> I created simple console application for macOS which can help you with creating custom dynamic wallpapers: <a href="https://github.com/mczachurski/wallpapper" target="_blank" rel="noopener">https://github.com/mczachurski/wallpapper</a><br><strong>更新：</strong>我为macOS创建了简单的控制台应用程序，它可以帮助您创建自定义动态壁纸：<a href="https://github.com/mczachurski/wallpapper" target="_blank" rel="noopener">https://github.com/mczachurski/wallpapper</a></p><p>本文翻译自：<br><a href="https://itnext.io/macos-mojave-dynamic-wallpaper-fd26b0698223" target="_blank" rel="noopener">https://itnext.io/macos-mojave-dynamic-wallpaper-fd26b0698223</a><br><a href="https://itnext.io/macos-mojave-dynamic-wallpapers-ii-f8b1e55c82f" target="_blank" rel="noopener">https://itnext.io/macos-mojave-dynamic-wallpapers-ii-f8b1e55c82f</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/2019-02/1_qjVGv0IMNTeKFIcks41ohA.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;How Apple built dynamic wallpapers? And is it possible to create your own dynamic wallpaper for macOS? I spent some time because I would like to answer to the both above questions.&lt;br&gt;Apple如何构建动态壁纸？是否可以为macOS创建自己的动态壁纸？我花了一些时间，因为我想回答上述两个问题。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;In Mojave we can choose new type of wallpaper: dynamic.&lt;br&gt;在Mojave，我们可以选择新型壁纸：动态。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2019-02/1_4a3SZs7wS3g3AtO8E2RNvw.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Depending on day time, system displays different wallpaper. At night it is picture of Mojave at night, during day it’s picture of Mojave taken during day. So at night we have dark wallpaper at day we have light wallpaper.&lt;br&gt;根据时间，系统会显示不同的壁纸。晚上显示Mojave晚上的照片，白天则是在白天拍摄的Mojave的照片。所以晚上我们有暗色的壁纸，白天则是明亮的壁纸。&lt;/p&gt;
&lt;p&gt;All built in wallpapers in macOS we can find in folder: &lt;code&gt;/Library/Desktop Pictures&lt;/code&gt;. Also here we can find dynamic wallpaper.&lt;br&gt;我们可以在文件夹&lt;code&gt;/Library/Desktop Pictures&lt;/code&gt;中找到所有macOS内置的壁纸。在这里我们也可以找到动态壁纸。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2019-02/1_lRpwIxzeyEoXMbz97ZfG5Q.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Dynamic wallpaper is saved as a HEIC file (&lt;code&gt;Mojave (Dynamic).heic&lt;/code&gt;). More information about this type of file you can find on &lt;a href=&quot;https://en.wikipedia.org/wiki/High_Efficiency_Image_File_Format&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Wikipedia&lt;/a&gt;. Generally this is type of file which Apple uses in iOS devices. Photos in iOS (also live photos) are stored as a HEIC file. That kind of file can contains multiple images/thumbnails and metadata in a single file.&lt;br&gt;动态壁纸保存为HEIC文件（&lt;code&gt;Mojave (Dynamic).heic&lt;/code&gt;）。有关此类文件的更多信息，请访问&lt;a href=&quot;https://en.wikipedia.org/wiki/High_Efficiency_Image_File_Format&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Wikipedia&lt;/a&gt;。通常，这是Apple在iOS设备中使用的文件类型。iOS中的照片（也包括实时照片）会存储为HEIC文件。这种文件可以在单个文件中包含多个图像/缩略图和元数据。&lt;/p&gt;
&lt;p&gt;There is really good online tool where we can check content of Mojave wallpaper file: &lt;a href=&quot;https://strukturag.github.io/libheif/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://strukturag.github.io/libheif/&lt;/a&gt;. You can upload &lt;code&gt;Mojave (Dynamic).heic&lt;/code&gt; file and you will see that in this single file there is 16 separate pictures taken in different day phase.&lt;br&gt;有一个很好的在线工具，让我们可以检查Mojave壁纸文件的内容：&lt;a href=&quot;https://strukturag.github.io/libheif/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://strukturag.github.io/libheif/&lt;/a&gt; 。你可以上传&lt;code&gt;Mojave (Dynamic).heic&lt;/code&gt;文件，然后你会发现在这个单独的文件中有16张不同时间拍摄的单独照片。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2019-02/1_ESDAv949YKQIEocL-qDcGA.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;So maybe it’s enough to create new HEIC file with 16 separate images and macOS will show them properly. Let’s try it!&lt;br&gt;所以也许它足以创建具有16个单独图像的新HEIC文件，macOS将正确显示它们。我们来试试吧！&lt;/p&gt;
    
    </summary>
    
      <category term="技术" scheme="https://zhangshuqiao.org/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Mac" scheme="https://zhangshuqiao.org/tags/Mac/"/>
    
  </entry>
  
  <entry>
    <title>十五的月亮十五圆</title>
    <link href="https://zhangshuqiao.org/2019-02/%E5%8D%81%E4%BA%94%E7%9A%84%E6%9C%88%E4%BA%AE%E5%8D%81%E4%BA%94%E5%9C%86/"/>
    <id>https://zhangshuqiao.org/2019-02/十五的月亮十五圆/</id>
    <published>2019-02-20T12:53:14.000Z</published>
    <updated>2019-02-20T14:56:41.290Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>摄于己亥年正月十六</p></blockquote><p><img src="/images/2019-02/IMG_4634.jpg" alt=""></p><p><em>400mm f/8 1/160s</em></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;摄于己亥年正月十六&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/images/2019-02/IMG_4634.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;400mm f/8 1/160s&lt;/em&gt;&lt;/p&gt;

      
    
    </summary>
    
      <category term="其他" scheme="https://zhangshuqiao.org/categories/%E5%85%B6%E4%BB%96/"/>
    
    
      <category term="摄影" scheme="https://zhangshuqiao.org/tags/%E6%91%84%E5%BD%B1/"/>
    
  </entry>
  
  <entry>
    <title>用Telnet观看Bad Apple!!</title>
    <link href="https://zhangshuqiao.org/2019-02/%E7%94%A8Telnet%E8%A7%82%E7%9C%8BBad%20Apple!!/"/>
    <id>https://zhangshuqiao.org/2019-02/用Telnet观看Bad Apple!!/</id>
    <published>2019-02-14T06:12:27.000Z</published>
    <updated>2019-02-25T02:25:42.638Z</updated>
    
    <content type="html"><![CDATA[<p>在前面的文章<a href="/2018-11/用Telnet观看Nyancat动画/">用Telnet观看Nyancat动画</a>中，博主曾表示正在尝试搭建一个可以播放Bad Apple!!的Telnet服务器。以Nyancat为基础，改写的过程并不复杂（除了硬编码了一个头文件，存储了所有动画帧）；只是因为懒，所以现在才终于完工了。你可以通过执行<code>telnet zsq.im 8082</code>查看效果。</p><p><img src="/images/2019-02/IMG_1061.jpg" alt=""></p><p>下面附上安装方法。</p><h2 id="下载编译"><a href="#下载编译" class="headerlink" title="下载编译"></a>下载编译</h2><p>在命令行执行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/stevenjoezhang/badapple.git</span><br><span class="line"><span class="built_in">cd</span> badapple</span><br><span class="line">make</span><br><span class="line">mv src/badapple /usr/bin <span class="comment">#or make install</span></span><br></pre></td></tr></table></figure></p><p>这时，通过<code>badapple</code>或<code>badapple -t</code>命令就可以查看效果。接下来把Telnet配置好就行了。</p><h2 id="配置Telnet"><a href="#配置Telnet" class="headerlink" title="配置Telnet"></a>配置Telnet</h2><p>这与之前的那篇文章几乎完全相同，仍然需要使用<code>xinetd</code>。只要把<code>server</code>中的<code>/usr/bin/nyancat</code>替换为<code>/usr/bin/badapple</code>即可。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;在前面的文章&lt;a href=&quot;/2018-11/用Telnet观看Nyancat动画/&quot;&gt;用Telnet观看Nyancat动画&lt;/a&gt;中，博主曾表示正在尝试搭建一个可以播放Bad Apple!!的Telnet服务器。以Nyancat为基础，改写的过程并不复杂（除了硬编码了一
      
    
    </summary>
    
      <category term="技术" scheme="https://zhangshuqiao.org/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Linux" scheme="https://zhangshuqiao.org/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>米米影视新片头震撼发布</title>
    <link href="https://zhangshuqiao.org/2019-02/%E7%B1%B3%E7%B1%B3%E5%BD%B1%E8%A7%86%E6%96%B0%E7%89%87%E5%A4%B4%E9%9C%87%E6%92%BC%E5%8F%91%E5%B8%83/"/>
    <id>https://zhangshuqiao.org/2019-02/米米影视新片头震撼发布/</id>
    <published>2019-02-04T16:00:00.000Z</published>
    <updated>2019-03-04T03:14:43.895Z</updated>
    
    <content type="html"><![CDATA[<p>新年快乐！值此新春佳节之际，米米影视的新版片头正式推出了。借助于Final Cut Pro，新片头成功地融合了理想与现实、传统与现代，让你体会到无与伦比的、直击心灵的震撼。</p><video src="/files/intro.mp4" preload="metadata" controls playsinline="" poster="">Sorry, your browser does not support the video tag.</video>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;新年快乐！值此新春佳节之际，米米影视的新版片头正式推出了。借助于Final Cut Pro，新片头成功地融合了理想与现实、传统与现代，让你体会到无与伦比的、直击心灵的震撼。&lt;/p&gt;
&lt;video src=&quot;/files/intro.mp4&quot; preload=&quot;metadat
      
    
    </summary>
    
      <category term="其他" scheme="https://zhangshuqiao.org/categories/%E5%85%B6%E4%BB%96/"/>
    
    
  </entry>
  
  <entry>
    <title>鱼眼镜头与小行星特效</title>
    <link href="https://zhangshuqiao.org/2019-01/%E9%B1%BC%E7%9C%BC%E9%95%9C%E5%A4%B4%E4%B8%8E%E5%B0%8F%E8%A1%8C%E6%98%9F%E7%89%B9%E6%95%88/"/>
    <id>https://zhangshuqiao.org/2019-01/鱼眼镜头与小行星特效/</id>
    <published>2019-01-28T06:18:34.000Z</published>
    <updated>2019-03-13T16:01:04.624Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/2019-01/EclipsePrince_Vetter_1500.jpg" alt=""></p><p>In this beautifully rendered “little planet” image, photographer <a href="https://www.facebook.com/stephane.vetter.nuitsacrees" target="_blank" rel="noopener">Stephane Vetter</a> fuses both night and day captured from a single location at Magone Lake in Oregon during the August 21st solar eclipse. The shot required tons of careful planning, and here’s an explanation of how he did it via <a href="https://apod.nasa.gov/apod/astropix.html" target="_blank" rel="noopener">Astronomy Picture of the Day</a>:<br>在8月21日的日食期间，摄影师<a href="https://www.facebook.com/stephane.vetter.nuitsacrees" target="_blank" rel="noopener">Stephane Vetter</a>于俄勒冈州马格纳湖的同一地点，融合了白天和黑夜的景象，完成了这个精美渲染的『小行星』图像。拍摄需要大量的精心策划，这里是他通过<a href="https://apod.nasa.gov/apod/astropix.html" target="_blank" rel="noopener">Astronomy Picture of the Day</a>解释他是如何做到的：</p><blockquote><p>This featured little-planet, all-sky, double time-lapse, digitally-fused composite captured celestial action during both night and day from a single location. In this 360×180 panorama, north and south are at the image bottom and top, while east and west are at the left and right edges, respectively. During four hours the night before the eclipse, star trails were captured circling the north celestial pole (bottom) as the Earth spun. During the day of the total eclipse, the Sun was captured every fifteen minutes from sunrise to sunset (top), sometimes in partial eclipse. All of these images were then digitally merged onto a single image taken exactly during the total solar eclipse. Then, the Sun’s bright corona could be seen flaring around the dark new Moon (upper left), while Venus simultaneously became easily visible (top). The tree in the middle, below the camera, is a Douglas fir.<br>这是一个小行星、全天空、双时延、数字融合的复合材料，在同一个地方，从夜间到白天持续捕获天体运动。在这个360×180全景图中，北部和南部分别位于图像的底部和顶部，而东部和西部分别位于左右边缘。在日食前一个晚上的四个小时内，当地球旋转时，在北天极（底部）环绕着星轨。在日全食期间，从日出到日落（上图）每隔十五分钟拍摄一次太阳，有时是偏食。然后将所有这些图像数字合并到在日全食期间拍摄的单个图像上。然后，可以看到太阳的明亮日冕在黑暗的新月（左上）周围闪烁，而金星同时变得容易看见（顶部）。中间的树，在相机下面，是道格拉斯冷杉。</p></blockquote><p>So, just your typical full eclipse, little-planet, all-sky, double time-lapse photo by a fir tree, really. You can see more of Vetter’s photography on his <a href="http://nuitsacrees.fr" target="_blank" rel="noopener">website</a>.<br>所以，这就是典型的日全食、小行星、全天空、双时延照片，借助一棵冷杉拍摄，仅此而已。你可以在Vetter的<a href="http://nuitsacrees.fr" target="_blank" rel="noopener">网站</a>上看到更多他的摄影作品。</p><hr><p>本文翻译自：<a href="https://www.thisiscolossal.com/2017/08/a-panoramic-eclipse-composite-with-star-trails-captured-by-stephane-vetter/" target="_blank" rel="noopener">A Panoramic Full Eclipse Composite with Star Trails Captured by Stephane Vetter</a></p><p>这样的『小行星』图像虽然具有鱼眼镜头的扭曲效果，但是并不一定需要使用鱼眼镜头拍摄。通过强大的图像后期处理技术，只要拍摄多个角度的照片，也可以合成出这样的效果。</p><p>拓展阅读：<a href="https://www.zhihu.com/question/27440901" target="_blank" rel="noopener">360度球状全景的照片是怎样拍出来的？ - 知乎</a></p><p>更多小行星特效：<br><a href="http://720.jum8.com/quanjing/xx/" target="_blank" rel="noopener">小行星转场+车内全景</a><br><a href="https://720yun.com/t/eeb24mf59tn?scene_id=487241" target="_blank" rel="noopener">天使眼中的天堂——华中师大一附中</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/2019-01/EclipsePrince_Vetter_1500.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;In this beautifully rendered “little planet” image, photographer 
      
    
    </summary>
    
      <category term="技术" scheme="https://zhangshuqiao.org/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="摄影" scheme="https://zhangshuqiao.org/tags/%E6%91%84%E5%BD%B1/"/>
    
  </entry>
  
  <entry>
    <title>树莓派使用RFID RC522芯片</title>
    <link href="https://zhangshuqiao.org/2019-01/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%BD%BF%E7%94%A8RFID%20RC522%E8%8A%AF%E7%89%87/"/>
    <id>https://zhangshuqiao.org/2019-01/树莓派使用RFID RC522芯片/</id>
    <published>2019-01-21T04:06:22.000Z</published>
    <updated>2019-02-25T02:38:10.125Z</updated>
    
    <content type="html"><![CDATA[<p>实用教程：树莓派使用RFID RC522芯片进行数据的读写</p><p><img src="/images/2019-01/raspberry-pi-RFID-Reader.jpg" alt=""></p><p>In this Raspberry Pi RFID RC522 tutorial, I will be walking you through the steps on how to set up and wire the RFID RC522 chip with your Raspberry Pi. This project is a cool circuit to play around with and opens you up to quite a wide variety of different projects from using it as an attendance system to using it to open a lock.<br>在这个Raspberry Pi RFID RC522教程中，我将介绍如何设置和连接Raspberry Pi和RFID RC522芯片。这是一个很实用的教程，以便于你之后各种不同的项目，例如使用它作为考勤系统、使用它来打开一个锁。</p><p>The RFID RC522 is a very low-cost RFID (Radio-frequency identification) reader and writer that is based on the MFRC522 microcontroller. This microcontroller provides its data through the SPI protocol and works by creating a 13.56MHz electromagnetic field that it uses to communicate with the RFID tags.<br>RFID RC522是基于MFRC522微控制器的非常低成本的RFID（射频识别）读写器。该微控制器通过SPI协议提供数据，并通过创建一个13.56MHz的电磁场来工作，该电磁场用于与RFID卡片进行通信。</p><p>Make sure that the tags you purchase for your RFID RC522 operate on the 13.56MHz frequency otherwise we will fail to read them.<br>确保你的RFID RC522购买的卡片在13.56MHz的频率上运行，否则将无法读取。</p><p>We will be showing you how to wire up the RC522 as well as showing you how to write Python scripts to interact with the chip so you can both read and write your RFID Tags. You can extend this tutorial to use something like a <a href="https://pimylifeup.com/raspberry-pi-lcd-16x2" target="_blank" rel="noopener">16×2 LCD for the Raspberry Pi</a>, handy if you want to show some information.<br>本教程将示范如何连接RC522以及编写Python脚本以与芯片进行交互，以便读取和写入RFID卡片。如果你想展示一些数据信息，你可以使用像<a href="https://pimylifeup.com/raspberry-pi-lcd-16x2" target="_blank" rel="noopener">16×2液晶显示器</a>扩展这个教程。</p><h2 id="Equipment-List"><a href="#Equipment-List" class="headerlink" title="Equipment List"></a>Equipment List</h2><p>设备清单</p><p>Below are all the bits and pieces that I used for this Raspberry Pi RFID RC522 tutorial.<br>下面列出的是我在这个教程中使用的东西。</p><p>Recommended:<br>推荐：</p><ul><li><p>Raspberry Pi 2 or 3<br>树莓派2或3</p></li><li><p>Micro SD Card<br>Micro SD卡</p></li><li><p>Power Supply<br>电源供应</p></li><li><p>RC522 RFID Reader<br>RC522 RFID读卡器</p></li><li><p>Breadboard<br>面包板</p></li><li><p>Breadboard Wire<br>面包板接线</p></li></ul><p>Optional:<br>可选：</p><ul><li><p>Raspberry Pi Case<br>树莓派外壳</p></li><li><p>Ethernet Network Connection or Wifi dongle (The Pi 3 has WiFi inbuilt)<br>以太网或Wifi适配（树莓派3自带了）</p></li></ul><a id="more"></a><h2 id="Assembling-the-RFID-RC522"><a href="#Assembling-the-RFID-RC522" class="headerlink" title="Assembling the RFID RC522"></a>Assembling the RFID RC522</h2><p>组装RFID RC522</p><p>One thing you will notice when purchasing an RFID RC522 Reader is that 90% of them don’t come with the header pins already soldered in. The missing pins mean you will have to do it yourself, luckily soldering header pins is a rather simple task, even for beginners.<br>购买RFID RC522读卡器时你会注意到的一件事情是，90％的读卡器没有使用已经焊接好的插头引脚。这意味着你必须自己做，幸运的是，焊接插头引脚是一个相当简单的任务，即使是对于初学者而言。</p><p>First off, if the header pins you received with your RC522 isn’t the correct size, then snap them down, so you only have a single row of eight pins.<br>首先，如果你使用RC522收到的插头引脚不是正确的大小，那么你只有一行8个引脚。</p><p>Place the header pins up through the holes of your RC522. One handy trick is to put the long side of the header pins into a breadboard and then putting the circuit over the top of the header pins. The breadboard will hold the pins tightly making it easier to solder them to the RFID RC522 circuit.<br>将插头引脚向上穿过RC522的孔。一个小窍门是把插头引脚的长边插入面包板，然后把电路放在接头引脚的顶部。面包板将固定住引脚，使其更容易焊接到RFID RC522电路。</p><p>Now using a hot soldering iron and some solder, slowly solder each of the pins. Remember it is best to heat the joint slightly before applying solder to it, this will ensure that the solder will adhere more to the joint and reduce the chances of creating a cold joint. We also recommend being careful with the amount of solder you apply.<br>现在使用热的烙铁和一些焊锡，慢慢地焊接每个引脚。请记住，在焊接之前，最好稍微加热接头，这样可以确保焊锡更多地粘附在接头上，并减少了形成冷接头的机会。我们还建议小心使用焊锡，避免过量。</p><p>With the header pins now soldered to your RFID circuit, it is now ready to use, and you can continue with the tutorial.<br>现在插头引脚已经焊接到你的RFID电路上，现在可以使用了，你可以跟着这个教程继续。</p><h2 id="Wiring-the-RFID-RC522"><a href="#Wiring-the-RFID-RC522" class="headerlink" title="Wiring the RFID RC522"></a>Wiring the RFID RC522</h2><p>连接RFID RC522</p><p>On your RFID RC522 you will notice that there are 8 possible connections on it, these being <strong>SDA</strong> (Serial Data Signal), <strong>SCK</strong> (Serial Clock), <strong>MOSI</strong> (Master Out Slave In), <strong>MISO</strong> (Master In Slave Out), <strong>IRQ</strong> (Interrupt Request), <strong>GND</strong> (Ground Power), <strong>RST</strong> (Reset-Circuit) and <strong>3.3v</strong> (3.3v Power In). We will need to wire all of these but the <strong>IRQ</strong> to our Raspberry Pi’s GPIO pins.<br>在你的RFID RC522上，你会发现，它有8个可能的引脚，这分别是<strong>SDA</strong>（串行数据信号），<strong>SCK</strong>（串行时钟），<strong>MOSI</strong>（主出从入），<strong>MISO</strong>（主入从出），<strong>IRQ</strong>（中断请求），<strong>GND</strong>（地面电源），<strong>RST</strong>（复位电路）和<strong>3.3V</strong>（3.3V电源输入）。我们需要把所有这些引脚，除了<strong>IRQ</strong>之外，都连接到Raspberry Pi的GPIO引脚。</p><p>You can either wire these directly to the GPIO Pins or like we did in this tutorial, plug the RFID RC522 into our Breadboard then wire from there to our Raspberry Pi’s GPIO Pins.<br>你可以将这些直接连接到GPIO引脚，或者像我们在本教程中所做的那样，将RFID RC522插入我们的面包板，然后从那里连接到我们的Raspberry Pi的GPIO引脚。</p><p>Wiring your RFID RC522 to your Raspberry Pi is fairly simple, with it requiring you to connect just 7 of the GPIO Pins directly to the RFID reader. Follow the table below, and check out our GPIO guide to see the positions of the GPIO pins that you need to connect your RC522 to.<br>将RFID RC522连接到Raspberry Pi相当简单，只需要将7个GPIO引脚直接连接到RFID读卡器。请遵循下表，并查阅我们的GPIO指南，查看连接RC522所需的GPIO引脚位置。</p><ul><li><p><strong>SDA</strong> connects to Pin 24.<br><strong>SDA</strong>连接到引脚24。</p></li><li><p><strong>SCK</strong> connects to Pin 23.<br><strong>SCK</strong>连接到引脚23。</p></li><li><p><strong>MOSI</strong> connects to Pin 19.<br><strong>MOSI</strong>连接到引脚19。</p></li><li><p><strong>MISO</strong> connects to Pin 21.<br><strong>MISO</strong>连接到引脚21。</p></li><li><p><strong>GND</strong> connects to Pin 6.<br><strong>GND</strong>连接到引脚6。</p></li><li><p><strong>RST</strong> connects to Pin 22.<br><strong>RST</strong>连接到引脚22。</p></li><li><p><strong>3.3v</strong> connects to Pin 1.<br><strong>3.3V</strong>连接到引脚1。</p></li></ul><p><img src="/images/2019-01/RFID-Fritz-v2.png" alt=""></p><p><img src="/images/2019-01/RFID-GPIO-Connection.jpg" alt=""></p><h2 id="Setting-up-Raspbian-for-the-RFID-RC522"><a href="#Setting-up-Raspbian-for-the-RFID-RC522" class="headerlink" title="Setting up Raspbian for the RFID RC522"></a>Setting up Raspbian for the RFID RC522</h2><p>为RFID RC522设置Raspbian</p><p>Before we begin the process of utilizing the RFID RC522 on our Raspberry Pi, we will first have to make changes to its configuration. By default, the Raspberry Pi has the SPI (Serial Peripheral Interface) disabled, which is a bit of a problem as that is what our RFID reader circuit runs through.<br>在我们开始在Raspberry Pi上使用RFID RC522之前，我们将首先对其配置进行更改。默认情况下，树莓派的SPI（串行外设接口）是被禁用的。<br>Don’t worry though as it is fairly simple to re-enable this interface, just follow our steps below to configure your Raspberry Pi and Raspbian to utilize the SPI interface.<br>不要担心，因为重新启用此接口非常简单，只需按照以下步骤配置Raspberry Pi和Raspbian即可使用SPI接口。</p><p>Let’s begin by first opening the <strong>raspi-config</strong> tool, and we can do this by opening the terminal and running the following command.<br>首先打开<strong>raspi-config</strong>工具，打开终端并运行以下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo raspi-config</span><br></pre></td></tr></table></figure></p><p>This tool will load up a screen showing a variety of different options. If you want a more in-depth look into these options, you can check <a href="https://pimylifeup.com/raspi-config-tool" target="_blank" rel="noopener">out our raspi-config guide</a>.<br>该工具将加载一个显示各种不同选项的界面。如果你想深入了解这些选项，可以参阅我们的<a href="https://pimylifeup.com/raspi-config-tool" target="_blank" rel="noopener">raspi-config指南</a>。</p><p>On here use the <strong>arrow keys</strong> to select <strong>“5 Interfacing Options”</strong>. Once you have this option selected, press <strong>Enter</strong>.<br>在这里使用<strong>方向键</strong>选择『<strong>5 Interfacing Options</strong>』。选中此选项后，按<strong>回车</strong>。</p><p>Now on this next screen, you want to use your <strong>arrow keys</strong> to select <strong>“P4 SPI”</strong>, again press Enter to select the option once it is highlighted.<br>现在在下一个界面上，你需要使用<strong>方向键</strong>选择『<strong>P4 SPI</strong>』，再次按回车选择高亮显示的选项。</p><p>You will now be asked if you want to enable the SPI Interface, select <strong>Yes</strong> with your <strong>arrow keys</strong> and press <strong>Enter</strong> to proceed. You will need to wait a little bit while the <strong>raspi-config</strong> tool does its thing in enabling SPI.<br>现在将询问你是否要启用SPI接口，使用<strong>方向键</strong>选择<strong>Yes</strong>，然后按<strong>回车</strong>继续。你需要等一会儿，<strong>raspi-config</strong>工具会启用SPI。</p><p>Once the SPI interface has been successfully enabled by the <strong>raspi-config</strong> tool you should see the following text appear on the screen, <strong>“The SPI interface is enabled”</strong>.<br>一旦通过<strong>raspi-config</strong>工具成功启用了SPI接口，你应该会看到屏幕上出现以下文本：『<strong>The SPI interface is enabled</strong>』。</p><p>Before the SPI Interface is fully enabled we will first have to restart the Raspberry Pi. To do this first get back to the terminal by pressing <strong>Enter</strong> and then <kbd><strong>ESC</strong><kbd>.<br>在SPI接口完全启用之前，我们将首先重新启动Raspberry Pi。要做到这一点首先回到终端按<strong>回车</strong>，然后按<kbd><strong>ESC</strong><kbd>。</kbd></kbd></kbd></kbd></p><p>Type the following <a href="https://pimylifeup.com/linux-commands-cheat-sheet" target="_blank" rel="noopener">Linux command into the terminal</a> on your Raspberry Pi to restart your Raspberry Pi.<br>在Raspberry Pi的终端中输入以下<a href="https://pimylifeup.com/linux-commands-cheat-sheet" target="_blank" rel="noopener">Linux命令</a>来重启。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo reboot</span><br></pre></td></tr></table></figure></p><p>Once your Raspberry Pi has finished rebooting, we can now check to make sure that it has in fact been enabled. The easiest way to do this is to run the following command to see if <strong>spi_bcm2835</strong> is listed.<br>在Raspberry Pi完成重启后，我们现在可以检查确认它已经被启用。最简单的方法是运行以下命令，查看是否列出了<strong>spi_bcm2835</strong>。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep spi</span><br></pre></td></tr></table></figure></p><p>If you see <strong>spi_bcm2835</strong>, then you can proceed on with this tutorial and skip on to the next section. If for some reason it had not appeared when you entered the previous command, try following the next three steps.<br>如果你看到<strong>spi_bcm2835</strong>，那么你可以继续，直接跳到下一节。如果由于某种原因，当你输入上一个命令时没有出现，请尝试执行以下3个步骤。</p><p>If for some reason the SPI module has not activated, we can edit the boot configuration file manually by running the following command on our Raspberry Pi.<br>如果由于某种原因SPI模块没有激活，我们可以通过在我们的Raspberry Pi上运行以下命令来手动编辑启动配置文件。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /boot/config.txt</span><br></pre></td></tr></table></figure></p><p>Within the configuration file, use <kbd>Ctrl</kbd>+<kbd>W</kbd> to find <strong>“dtparam=spi=on”</strong>.<br>在配置文件中，使用<kbd>Ctrl</kbd>+<kbd>W</kbd>查找『<strong>dtparam=spi=on</strong>』。</p><p>If you have found it, check to see if there is a # in front of it. If there is, remove it as this is commenting out the activation line. If you can’t find the line at all, add “dtparam=spi=on” to the bottom of the file.<br>如果你找到了，请检查前面是否有<code>#</code>号。如果有，就删除它，因为这是用来注释一行代码的。如果找不到该行，只需在文件底部添加『dtparam = spi = on』即可。</p><p>Once you have made the changes, you can press <kbd>Ctrl</kbd>+<kbd>X</kbd> then pressing <kbd>Y</kbd> and then Enter to save the changes.<br>完成更改后，可以按<kbd>Ctrl</kbd>+<kbd>X</kbd>，然后按<kbd>Y</kbd>，然后按回车以保存更改。</p><p>You can now proceed from Step 5 again, rebooting your Raspberry Pi then checking to see if the module has been enabled.<br>现在，你可以回到前面的步骤，重新启动Raspberry Pi，然后检查模块是否已启用。</p><h2 id="Getting-Python-ready-for-the-RFID-RC522"><a href="#Getting-Python-ready-for-the-RFID-RC522" class="headerlink" title="Getting Python ready for the RFID RC522"></a>Getting Python ready for the RFID RC522</h2><p>为RFID RC522准备好Python</p><p>Now that we have wired up our RFID RC522 circuit to the Raspberry Pi we can now power it on and begin the process of programming simple scripts in Python to interact with the chip.<br>现在我们已经将RFID RC522电路连接到Raspberry Pi。我们可以启动它，开始编写简单的Python脚本以与芯片进行交互。</p><p>The scripts that we will be showing you how to write will show you how to read data from the RFID chips and how to write to them. These will give you the basic idea of how data is dealt with and will be the basis of further RFID RC522 tutorials.<br>我们将向你展示如何编写脚本，以及脚本如何从RFID芯片读取和写入数据。这将为你提供处理数据的基本概念，并将成为更多RFID RC522教程的基础。</p><p>Before we start programming, we first need to update our Raspberry Pi to ensure it’s running the latest version of all the software. Run the following two commands on your Raspberry Pi to update it.<br>在开始编程之前，我们首先需要更新我们的Raspberry Pi，以确保其运行所有软件的最新版本。在Raspberry Pi上运行以下两个命令来更新它。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade</span><br></pre></td></tr></table></figure></p><p>Now the final thing we need before we can proceed is to install the python2.7-dev package, simply run the following command on your Raspberry Pi to install it.<br>现在我们需要做的最后一件事是安装python2.7-dev包，只需在Raspberry Pi上运行以下命令即可安装它。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python2.7-dev</span><br></pre></td></tr></table></figure></p><p>To begin, we must first clone the Python Library SPI Py and install it to our Raspberry Pi. This library helps handle interactions with the SPI and is a key component to this tutorial as we need it for the Raspberry Pi to interact with the RFID RC522.<br>首先，我们必须首先克隆Python Library SPI Py并将其安装到我们的Raspberry Pi。这个库有助于处理与SPI的交互，并且是本教程的关键组件，因为我们需要Raspberry Pi与RFID RC522进行交互。</p><p>Run the following two commands on your Raspberry Pi to clone the source code.<br>在Raspberry Pi上运行以下两个命令来克隆源代码。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/lthiery/SPI-Py.git</span><br></pre></td></tr></table></figure></p><p>With the SPI Py Python Library now cloned to our Raspberry Pi, we need to install it, this is incredibly simple, as all we need to do is change into its directory and run a simple Python command on our Raspberry Pi.<br>现在将Python Py Python库克隆到我们的Raspberry Pi中，我们需要安装它，这是非常简单的，因为我们需要做的就是更改它的目录并在Raspberry Pi上运行一个简单的Python命令。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/SPI-Py</span><br><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure></p><p>Now that we have installed SPI-Py we can now clone our RFID RC522 Python code from the PiMyLifeUp Github. There are two files included in this repository:<br>现在我们已经安装了SPI-Py，现在我们可以从PiMyLifeUp的Github仓库中克隆我们的RFID RC522 Python代码。这个仓库中包含两个文件：</p><ul><li><p>MFRC522.py which is an implementation of the RFID RC522 circuit.<br>MFRC522.py是RFID RC522电路的一个实现。</p></li><li><p>SimpleMFRC522.py that takes the MFRC522.py file and greatly simplifies it.<br>SimpleMFRC522.py采用MFRC522.py文件，并大大简化它。</p></li></ul><p>To clone this repository, you can type the following two commands into your Raspberry Pi.<br>为了克隆这个仓库，你可以在Raspberry Pi中输入以下两个命令。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/pimylifeup/MFRC522-python.git</span><br></pre></td></tr></table></figure></p><p>With the repository now saved to our Raspberry Pi, we can begin programming for our RFID RC522. To start off with we will be showing you how to write data to your RFID cards by using the RC522. Simply go onto our next section to begin programming our first Python script.<br>现在将存储库保存到我们的Raspberry Pi中，我们可以开始为我们的RFID RC522进行编程。首先，我们将向你展示如何使用RC522将数据写入RFID卡。只需进入下一节开始编程我们的第一个Python脚本。</p><h2 id="Writing-with-the-RFID-RC522"><a href="#Writing-with-the-RFID-RC522" class="headerlink" title="Writing with the RFID RC522"></a>Writing with the RFID RC522</h2><p>用RFID RC522写入</p><p>For our first Python script, we will be showing you how to write data from the RC522 to your RFID tags. Thanks to the SimpleMFRC522 script this will be relatively simple, but we will still go into how each part of the code words.<br>对于我们的第一个Python脚本，我们将向你展示如何将数据通过RC522写入你的RFID卡片。借助于SimpleMFRC522脚本，这相对来说是很简单的，但我们仍然会进入每个代码片段详细解释。</p><p>Begin by changing directory into our newly cloned folder, and begin writing our Write.py Python script.<br>首先将目录切换到我们新克隆的文件夹，然后开始编写我们的Write.py Python脚本。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/MFRC522-python</span><br><span class="line">sudo nano Write.py</span><br></pre></td></tr></table></figure></p><p>Within this file, write the following lines of code. This code will basically ask you for text to input and then write that text to the RFID Tag.<br>在这个文件中，写下面几行代码。这会要求你输入文字，然后将文字写入RFID卡片。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> RPi.GPIO <span class="keyword">as</span> GPIO</span><br><span class="line"><span class="keyword">import</span> SimpleMFRC522</span><br></pre></td></tr></table></figure></p><p>The first line of this segment of code helps tell the terminal how to interpret the file, and it lets it know that it should use Python when executing it and not something else such as Bash.<br>这段代码的第一行有助于告诉终端如何解释文件，它让它知道它应该在执行时使用Python，而不是其他的东西，如Bash。</p><p>Our first import, RPi.GPIO has all the functions needed to interact with the GPIO Pins, and we need this to make sure they are cleared when the script finishes running.<br>我们的第一个<code>import</code>，RPi.GPIO具有与GPIO引脚交互所需的所有功能，我们需要这个来确保在脚本运行完成后它们被清除。</p><p>The second import, imports in our SimpleMFRC522 library, this is what we will use actually to talk with the RFID RC522, it greatly simplifies dealing with the chip compared to the base MFRC522 library.<br>第二个<code>import</code>，导入了SimpleMFRC522库，这是我们将用来实际与RFID RC522进行通信的地方，与基本的MFRC522库相比，它极大地简化了处理芯片。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reader = SimpleMFRC522.SimpleMFRC522()</span><br></pre></td></tr></table></figure></p><p>This line creates a copy of the SimpleMFRC522 as an object, runs its setup function then stores it all in our reader variable.<br>这一行创建一个SimpleMFRC522作为对象的副本，运行它的设置功能，然后将它存储在我们的reader变量中。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    text = raw_input(<span class="string">'New data:'</span>)</span><br><span class="line">    print(<span class="string">"Now place your tag to write"</span>)</span><br><span class="line">    reader.write(text)</span><br><span class="line">    print(<span class="string">"Written"</span>)</span><br></pre></td></tr></table></figure></p><p>Our next block of code we keep within a try statement, this is so we can catch any exceptions and clean up properly. Make sure that you retain the ‘tabs’ after try: as Python is whitespace sensitive, and it is how it differs between blocks of code.<br>我们的下一个代码块保存在一个try语句中，这样我们就可以捕获任何异常并正确处理。确保在输入时正确地使用<code>tab</code>或者空格缩进：因为Python对缩进敏感，并且缩进是用来区分代码块的。</p><p>The second line here reads in an input from the command line, and we use raw_input in Python 2.7 to read in all input and store it in our text variable.<br>这里的第二行是从命令行读入一个输入，我们使用Python 2.7中的raw_input来读入所有的输入并将其存储在<code>text</code>变量中。</p><p>With the third line, we utilize print() to notify the user that they can now place their RFID tag down onto the reader for writing.<br>通过第三行，我们利用<code>print()</code>来通知用户，他们现在可以将RFID卡片放在读卡器上进行书写。</p><p>Afterward, on our fourth line of code we use our reader object to write the values we stored in the text variable to the RFID tag, this will tell the RFID RC522 Circuit to write the text values to a certain sector.<br>之后，在我们的第四行代码中，我们使用<code>reader</code>对象将存储在文本变量中的值写入RFID卡片，这基本上告诉RFID RC522电路将文本值写入某个扇区。</p><p>Finally, on the 5th line of code, we use print() again to notify the user that we have successfully written to the RFID tag.<br>最后在第五行代码中，我们再次使用<code>print()</code>来通知用户我们已经成功写入RFID卡片。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    GPIO.cleanup()</span><br></pre></td></tr></table></figure></p><p>Our final two lines of code handle exiting of the script. Finally, always occurs after the try statement, meaning no matter what we run the GPIO.cleanup() function. These lines are crucial as failing to clean up can prevent other scripts from working correctly.<br>我们最后的两行代码处理脚本的退出。<code>finally</code>总是在<code>try</code>语句之后出现，意思是不管发生什么错误，都运行<code>GPIO.cleanup()</code>函数。这是至关重要的，因为清理失败可能会阻止其他脚本正常工作。</p><p>Once you have finished writing in your script, it should look something like below.<br>一旦你完成了你的脚本的编写，它应该看起来如下所示。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> RPi.GPIO <span class="keyword">as</span> GPIO</span><br><span class="line"><span class="keyword">import</span> SimpleMFRC522</span><br><span class="line"></span><br><span class="line">reader = SimpleMFRC522.SimpleMFRC522()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    text = raw_input(<span class="string">'New data:'</span>)</span><br><span class="line">    print(<span class="string">"Now place your tag to write"</span>)</span><br><span class="line">    reader.write(text)</span><br><span class="line">    print(<span class="string">"Written"</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    GPIO.cleanup()</span><br></pre></td></tr></table></figure></p><p>Once you are happy that the code looks correct, you can save the file by pressing <kbd>Ctrl</kbd>+<kbd>X</kbd> then pressing <kbd>Y</kbd> and then finally hitting Enter.<br>一旦你感到代码看起来是正确的，你可以通过按下<kbd>Ctrl</kbd>+<kbd>X</kbd>然后按下<kbd>Y</kbd>，然后最后按回车来保存文件。</p><p>Now that we have written our script, we will want to test it out. Before testing out the script make sure that you have an RFID tag handy. Once ready, type the following command into your Raspberry Pi’s terminal.<br>现在我们已经写好了脚本，是时候来测试一下了。在测试脚本之前，确保你有一个可用的RFID卡片。准备好之后，在Raspberry Pi的终端中输入以下命令。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python Write.py</span><br></pre></td></tr></table></figure></p><p>You will be asked to write in the new data, in our case we are going to just type in pimylifeup as its short and simple. Press Enter when you are happy with what you have written.<br>你将被要求写入新的数据，在我们的例子中，我们只是简单地输入pimylifeup。当你对自己写的东西满意的时候，按下回车键。</p><p>With that done, simply place your RFID Tag on top of your RFID RC522 circuit. As soon as it detects it, it will immediately write the new data to the tag. You should see “Written” appear in your command line if it was successful.<br>完成后，将RFID卡片放在RFID RC522电路的读卡区域上。一旦检测到，它会立即将新数据写入卡片。如果成功，你应该看到『Written』出现在你的命令行中。</p><p>You can look at our example output below to see what a successful run looks like.<br>你可以查看下面的示例输出以查看成功运行的样子。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~/MFRC522-python $ sudo python Write.py</span><br><span class="line">New data:pimylifeup</span><br><span class="line">Now place your tag to write</span><br><span class="line">Written</span><br></pre></td></tr></table></figure></p><p>You have now successfully written your Write.py script, and we can now proceed to show you how to read data from the RFID RC522 in the next segment of this tutorial.<br>现在，你已经成功编写了你的Write.py脚本，现在我们可以继续向你展示如何在本教程的下一部分中从RFID RC522读取数据。</p><h2 id="Reading-with-the-RFID-RC522"><a href="#Reading-with-the-RFID-RC522" class="headerlink" title="Reading with the RFID RC522"></a>Reading with the RFID RC522</h2><p>用RFID RC522读取</p><p>Now that we have written our script to write to RFID tags using our RC522 we can now write a script that will read this data back off the tag.<br>现在我们已经写了我们的脚本来使用我们的RC522来写入RFID卡片，现在我们可以编写一个脚本来读取这个数据。</p><p>Let’s start off by changing the directory to make sure we are in the right place, and then we can run nano to begin writing our Read.py script.<br>首先，通过更改目录来确保我们位于正确的位置，然后运行nano开始编写Read.py脚本。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/MFRC522-python</span><br><span class="line">sudo nano Read.py</span><br></pre></td></tr></table></figure></p><p>Within this file, write the following lines of code. This script will basically sit and wait till you put your RFID tag on the RFID RC522 reader, it will then output the data it reads off the tag.<br>在这个文件中，写下面几行代码。这个脚本会一直等待，直到你将你的RFID卡片放在RFID RC522读卡器上，它将输出卡片上读取的数据。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> RPi.GPIO <span class="keyword">as</span> GPIO</span><br><span class="line"><span class="keyword">import</span> SimpleMFRC522</span><br></pre></td></tr></table></figure></p><p>The first line of code tells the operating system how to handle the file when a user executes it. Otherwise, it will try and just run it as a regular script file and not a Python file.<br>当用户执行它时，第一行代码告诉操作系统如何处理文件。否则，它会尝试运行它作为一个普通的脚本文件，而不是一个Python文件。</p><p>The first import is, RPi.GPIO. This library contains all the functions to deal with the Raspberry Pi’s GPIO pins, and we mainly import this to ensure that we clean up when the script finishes executing.<br>第一个导入是RPi.GPIO。这个库包含了所有处理Raspberry Pi的GPIO引脚的函数，我们导入这个主要是来确保在脚本执行完成后进行清理。</p><p>The second import is, SimpleMFRC522. This script contains a few helper functions to make it an awful lot easier to deal with writing and reading from the RFID RC522, without it the scripts would become quite long.<br>第二个导入是SimpleMFRC522。这个脚本包含一些帮助功能，使得从RFID RC522的写入和读取处理变得非常容易，没有它，我们简单的脚本将变得相当长。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reader = SimpleMFRC522.SimpleMFRC522()</span><br></pre></td></tr></table></figure></p><p>This line is quite important as it calls SimpleMFRC522’s creation function and then stores that into our reader variable as an object so we can interact with it later.<br>这一行非常重要，因为它调用SimpleMFRC522的创建函数，然后将其作为对象存储到我们的reader变量中，以便稍后与之交互。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    id, text = reader.read()</span><br><span class="line">    print(id)</span><br><span class="line">    print(text)</span><br></pre></td></tr></table></figure></p><p>This next block of code is contained within a try statement, and we use this so we can catch any exceptions that might occur and deal with them nicely. You need to ensure that you use the ‘tabs‘ as shown after try: as Python is whitespace sensitive.<br>下一个代码块包含在一个try语句中，我们使用它来捕获可能发生的异常，并很好地处理它们。你需要确保在try之后使用<code>tab</code>或者空格缩进，因为Python对缩进敏感。</p><p>The second line in this block of code makes a call to our reader object, in this case, it tells the circuit to begin reading any RFID tag that is placed on top of the RC522 reader.<br>这段代码中的第二行调用我们的读卡器对象，在这种情况下，它告诉电路开始读取放置在RC522读卡器顶部的任何RFID卡片。</p><p>With the third and fourth lines we utilize print() to print out the information that we received from reading the RFID Chip, this includes the ID associated with the RFID tag and the text that is stored on the tag.<br>通过第三行和第四行，我们利用<code>print()</code>打印出读取RFID芯片时收到的信息，其中包括与RFID卡片关联的ID和存储在卡片上的文本。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    GPIO.cleanup()</span><br></pre></td></tr></table></figure></p><p>The two last lines of code handle the termination of the script. The finally statement always triggers after the try statement even if we get an exception.<br>最后两行代码处理脚本的终止。<code>finally</code>语句总是在<code>try</code>语句之后触发，即使我们得到一个异常。</p><p>This try statement ensures that no matter what we run the GPIO.cleanup() function. It is quite crucial as failing to clean up the GPIO can prevent other scripts from working correctly.<br>这个<code>try</code>语句可以确保不管发生什么，都会运行<code>GPIO.cleanup()</code>函数。这非常重要，因为如果未能清除GPIO，其他脚本将无法正常工作。</p><p>Now that you have finished writing your Read.py script for your RFID RC522 it should look something like what is shown below.<br>现在你已经完成了为你的RFID RC522编写Read.py脚本，它应该看起来如下所示：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> RPi.GPIO <span class="keyword">as</span> GPIO</span><br><span class="line"><span class="keyword">import</span> SimpleMFRC522</span><br><span class="line"></span><br><span class="line">reader = SimpleMFRC522.SimpleMFRC522()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    id, text = reader.read()</span><br><span class="line">    print(id)</span><br><span class="line">    print(text)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    GPIO.cleanup()</span><br></pre></td></tr></table></figure></p><p>Once you are sure you have entered the code correctly, you can save the file by pressing <kbd>Ctrl</kbd>+<kbd>X</kbd> then pressing <kbd>Y</kbd> and then finally hitting Enter.<br>一旦你确定你已经输入了正确的代码，你可以通过按<kbd>Ctrl</kbd>+<kbd>X</kbd>然后按<kbd>Y</kbd>，然后最后按回车来保存文件。</p><p>Now that we have finally finished our Read.py script we need to test it out. Before we test out the script, grab one of the RFID tags that you want to read. Once that you are ready, type the following command into your Raspberry Pi’s terminal.<br>现在我们已经完成了我们的Read.py脚本，我们需要测试它。在我们测试脚本之前，准备一个你想读的RFID卡片。一旦你准备好了，在Raspberry Pi的终端中输入以下命令。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python Read.py</span><br></pre></td></tr></table></figure></p><p>With the script now running, all you need to do is place your RFID Tag on top of your RFID RC522 circuit. As soon as the Python script detects the RFID tag being placed on top, it will immediately read the data and print it back out to you.<br>现在脚本正在运行，你只需将你的RFID卡片放在RFID RC522电路的顶部。一旦Python脚本检测到RFID卡片被放置在顶部，它将立即读取数据并将其打印回给你。</p><p>An example of what a successful output would look like is displayed below.<br>下面显示了一个成功输出的例子。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pi@raspberrypi:~/MFRC522-python $ sudo python Read.py</span><br><span class="line">7843705425</span><br><span class="line">pimylifeup</span><br></pre></td></tr></table></figure></p><p>If you successfully receive data back from your Read.py script with the text that you pushed to the card using your Write.py script then you have successfully set up your Raspberry Pi to connect with your RFID RC522 Circuit.<br>如果你成功从你的Read.py脚本接收到数据，并使用你的Write.py脚本将文本推送到卡上，那么你已经成功设置了Raspberry Pi来连接RFID RC522电路。</p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>We will be going into more depth with these scripts and the RFID chip in later tutorials. It will include exploring how to set up an attendance system among other cool DIY Pi projects.<br>在稍后的教程中，我们将会深入探讨这些脚本和RFID芯片。这包括探索如何在其他酷派DIY Pi项目中设置考勤系统。</p><p>If you have enjoyed this Raspberry RFID RC522 tutorial or have any feedback, then feel free to drop a comment over at our forum.<br>如果你喜欢这款Raspberry RFID RC522教程，或有任何反馈，请随时在下面留言！</p><hr><p>本文翻译自：<a href="https://pimylifeup.com/raspberry-pi-rfid-rc522" target="_blank" rel="noopener">How to setup a Raspberry Pi RFID RC522 Chip</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;实用教程：树莓派使用RFID RC522芯片进行数据的读写&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2019-01/raspberry-pi-RFID-Reader.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;In this Raspberry Pi RFID RC522 tutorial, I will be walking you through the steps on how to set up and wire the RFID RC522 chip with your Raspberry Pi. This project is a cool circuit to play around with and opens you up to quite a wide variety of different projects from using it as an attendance system to using it to open a lock.&lt;br&gt;在这个Raspberry Pi RFID RC522教程中，我将介绍如何设置和连接Raspberry Pi和RFID RC522芯片。这是一个很实用的教程，以便于你之后各种不同的项目，例如使用它作为考勤系统、使用它来打开一个锁。&lt;/p&gt;
&lt;p&gt;The RFID RC522 is a very low-cost RFID (Radio-frequency identification) reader and writer that is based on the MFRC522 microcontroller. This microcontroller provides its data through the SPI protocol and works by creating a 13.56MHz electromagnetic field that it uses to communicate with the RFID tags.&lt;br&gt;RFID RC522是基于MFRC522微控制器的非常低成本的RFID（射频识别）读写器。该微控制器通过SPI协议提供数据，并通过创建一个13.56MHz的电磁场来工作，该电磁场用于与RFID卡片进行通信。&lt;/p&gt;
&lt;p&gt;Make sure that the tags you purchase for your RFID RC522 operate on the 13.56MHz frequency otherwise we will fail to read them.&lt;br&gt;确保你的RFID RC522购买的卡片在13.56MHz的频率上运行，否则将无法读取。&lt;/p&gt;
&lt;p&gt;We will be showing you how to wire up the RC522 as well as showing you how to write Python scripts to interact with the chip so you can both read and write your RFID Tags. You can extend this tutorial to use something like a &lt;a href=&quot;https://pimylifeup.com/raspberry-pi-lcd-16x2&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;16×2 LCD for the Raspberry Pi&lt;/a&gt;, handy if you want to show some information.&lt;br&gt;本教程将示范如何连接RC522以及编写Python脚本以与芯片进行交互，以便读取和写入RFID卡片。如果你想展示一些数据信息，你可以使用像&lt;a href=&quot;https://pimylifeup.com/raspberry-pi-lcd-16x2&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;16×2液晶显示器&lt;/a&gt;扩展这个教程。&lt;/p&gt;
&lt;h2 id=&quot;Equipment-List&quot;&gt;&lt;a href=&quot;#Equipment-List&quot; class=&quot;headerlink&quot; title=&quot;Equipment List&quot;&gt;&lt;/a&gt;Equipment List&lt;/h2&gt;&lt;p&gt;设备清单&lt;/p&gt;
&lt;p&gt;Below are all the bits and pieces that I used for this Raspberry Pi RFID RC522 tutorial.&lt;br&gt;下面列出的是我在这个教程中使用的东西。&lt;/p&gt;
&lt;p&gt;Recommended:&lt;br&gt;推荐：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Raspberry Pi 2 or 3&lt;br&gt;树莓派2或3&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Micro SD Card&lt;br&gt;Micro SD卡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Power Supply&lt;br&gt;电源供应&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;RC522 RFID Reader&lt;br&gt;RC522 RFID读卡器&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Breadboard&lt;br&gt;面包板&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Breadboard Wire&lt;br&gt;面包板接线&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Optional:&lt;br&gt;可选：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Raspberry Pi Case&lt;br&gt;树莓派外壳&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Ethernet Network Connection or Wifi dongle (The Pi 3 has WiFi inbuilt)&lt;br&gt;以太网或Wifi适配（树莓派3自带了）&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="程序设计" scheme="https://zhangshuqiao.org/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
    
      <category term="Linux" scheme="https://zhangshuqiao.org/tags/Linux/"/>
    
      <category term="Python" scheme="https://zhangshuqiao.org/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>如何进行曲线拟合</title>
    <link href="https://zhangshuqiao.org/2019-01/%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%9B%B2%E7%BA%BF%E6%8B%9F%E5%90%88/"/>
    <id>https://zhangshuqiao.org/2019-01/如何进行曲线拟合/</id>
    <published>2019-01-15T14:19:06.000Z</published>
    <updated>2019-02-05T10:32:30.874Z</updated>
    
    <content type="html"><![CDATA[<p>考完了计算物理（Numerical Analysis），用一张图表达一下心情。感觉像是考了一次高等代数，加一点点统计学。<br>本来计划寒假里把所有作业的代码整理并开源，结果最近自己审视了一下，愈发感觉代码写得惨不忍睹，就不献丑了。</p><p><img src="/images/2019-01/curve_fitting.png" alt=""></p><p>图片来源：<a href="https://www.xkcd.com/2048" target="_blank" rel="noopener">Curve-Fitting</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;考完了计算物理（Numerical Analysis），用一张图表达一下心情。感觉像是考了一次高等代数，加一点点统计学。&lt;br&gt;本来计划寒假里把所有作业的代码整理并开源，结果最近自己审视了一下，愈发感觉代码写得惨不忍睹，就不献丑了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/im
      
    
    </summary>
    
      <category term="幽默" scheme="https://zhangshuqiao.org/categories/%E5%B9%BD%E9%BB%98/"/>
    
    
  </entry>
  
  <entry>
    <title>什么是CAT等级？</title>
    <link href="https://zhangshuqiao.org/2019-01/%E4%BB%80%E4%B9%88%E6%98%AFCAT%E7%AD%89%E7%BA%A7%EF%BC%9F/"/>
    <id>https://zhangshuqiao.org/2019-01/什么是CAT等级？/</id>
    <published>2019-01-08T05:08:11.000Z</published>
    <updated>2019-03-03T13:47:28.793Z</updated>
    
    <content type="html"><![CDATA[<p>根据国际电子电工委员会IEC1010-1的定义，我们把电工工作的区域分为四个等级，分别称作CAT I，CAT II，CAT III和CAT IV。CAT等级是向下兼容的，也就是说，一块CAT IV的表用在CAT I，CAT II，CAT III下使用是完全安全的，但是一块CAT I的万用表用在CAT II，CAT III和CAT IV环境下使用就不保证安全了。</p><h3 id="CAT等级对用户意味着什么"><a href="#CAT等级对用户意味着什么" class="headerlink" title="CAT等级对用户意味着什么"></a>CAT等级对用户意味着什么</h3><p>CAT等级意味着对客户的人身安全承诺，它不仅仅是耐高压！CAT等级严格规定了电气工作人员在不同级别的电气环境中可能遇到的电气设备的类型以及在这样的区域中工作所使用的测量工具必须要遵循的安全标准。CAT后面的电压数值则表示了他们能够收到电压冲击的上限。<br>例如，一个CAT III 600V的万用表，表示该表可以在CAT I，II和III区域安全使用，在这三个区域里如果该表收到最高600V的电压冲击，表不会对人体安全产生威胁，但是这款表在CAT IV域使用时，或者到700V的高压冲击的时候，就不能保证同样的安全了。CAT等级是向下兼容的，也就是说，一块CAT IV的表用在CAT I，CAT II，CAT III下使用是完全安全的，但是一块CAT I的万用表用在CAT II，CAT III和CAT IV环境下使用就不保证安全了，表可能发生爆炸、燃烧威胁到你的安全。</p><h3 id="CAT等级划分"><a href="#CAT等级划分" class="headerlink" title="CAT等级划分"></a>CAT等级划分</h3><ul><li>CAT I：通过变压器或者类似设备连接到墙上插座的二次电气线路，例如电子仪器设备类。有保护措施的电子设备、任何高压、低压回路，如办公室内部的复印机等。</li><li>CAT II：通过电源线连接到室内插座的用电设备的一次电气线路，如移动式工具，家电等。家用电器、便携工具（电钻等）、家用插座，距离三类线路10米以上的插座或者距离四类线路20米以上的插座。</li><li>CAT III：直接连接到配电盘的大型设备的一次线路及配电盘与插座之间的电路线路（三相分配电路包括单个商业照明电路）。位置固定的设备，如多相马达、多相闸盒；大型建设物内部的照明设备、线路；工业现场（车间）的机床、电源配电盘等。</li><li>CAT IV：三相公用供电设备和室外供电线路设备。涉及到『初始连接』的设备，如电站的电力分配系统；电力仪表，前端过置保护，任何室外输电线路。</li></ul><p><img src="/images/2019-01/2ccd70dcb7a54444c2cfeb2fc78c23a3.png" alt=""></p><h3 id="如何理解CAT等级"><a href="#如何理解CAT等级" class="headerlink" title="如何理解CAT等级"></a>如何理解CAT等级</h3><p>CAT等级有各自的工作电压和瞬时峰值电压。CAT等级的工作电压分为：50V，150V，300V，600V，1000V。工作电压越高意味着能够承受的瞬时峰值电压也越高。<br>如下表所示：</p><table><thead><tr><th>等级</th><th>瞬时峰值</th></tr></thead><tbody><tr><td>CAT IV 600V</td><td>8kV impulse</td></tr><tr><td>CAT III 600V</td><td>6kV impulse</td></tr><tr><td>CAT III 1000V</td><td>8kV impulse</td></tr><tr><td>CAT II 600V</td><td>4kV impluse</td></tr><tr><td>CAT II 1000V</td><td>6kV impulse</td></tr></tbody></table><p>下图有更详细的数据：</p><p><img src="/images/2019-01/5e0693d4c540a6d44ba986dc647409cd.png" alt=""></p><h3 id="CAT-III-600V比CAT-II-1000V更安全"><a href="#CAT-III-600V比CAT-II-1000V更安全" class="headerlink" title="CAT III 600V比CAT II 1000V更安全"></a>CAT III 600V比CAT II 1000V更安全</h3><p>人们往往无法理解这一点，为什么只能承受600V电压的设备的比1000V更安全？<br>这里涉及到信号源阻抗的问题。信号源阻抗越大，CAT等级越低。由表1可知，CAT III等级的阻抗为2欧姆，CAT II等级的阻抗时12欧姆，即CAT II等级的源阻抗是CAT III等级阻抗的6倍。所以，虽然CAT III等级的电压虽小，但阻抗也小，电流大，从而能够承受更高能量的信号，所以说CAT III 600V比CAT II 1000V安全。<br>同一个CAT等级下，工作电压越高，其安全等级也越高（同一CAT等级的源阻抗相同）。例如：CAT III 1000V（8kV 瞬时高发）比CAT II 600V（6kV瞬时高压）更安全。<br>如果您需要测试一个电力电路，你应该会用到一个CAT III 600V或CAT IV 600V/CAT III 1000V的仪表，配套CAT IV-600V/CAT III-1000V测试线和探头。</p><h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><p>问：PicoScope的CAT I等级的高压探头TA044为什么配套 CAT III 1000V等级的探头尖端？是不是厂家弄错了。<br>答：不是。Pico所有的高压差分探头配套的都是CAT III等级的探头尖端。如下图所示。TA044整体上是一个在CAT I 环境中能够安全使用的设备，能够测量的最大单端电压7kV。探头尖端采用的是工作电压1000V的CAT III等级，该等级下能够承受的瞬时最大尖峰电压是8kV，所以CAT III等级的探头尖端 用起来更加安全。</p><p><img src="/images/2019-01/4fbf3af969c5f5b73093dbfd1600be96.png" alt=""></p><hr><p>本文转载自：<a href="http://www.eepw.com.cn/article/274406.htm" target="_blank" rel="noopener">CAT 等级</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;根据国际电子电工委员会IEC1010-1的定义，我们把电工工作的区域分为四个等级，分别称作CAT I，CAT II，CAT III和CAT IV。CAT等级是向下兼容的，也就是说，一块CAT IV的表用在CAT I，CAT II，CAT III下使用是完全安全的，但是一块C
      
    
    </summary>
    
      <category term="技术" scheme="https://zhangshuqiao.org/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>成功召唤独角兽</title>
    <link href="https://zhangshuqiao.org/2019-01/%E6%88%90%E5%8A%9F%E5%8F%AC%E5%94%A4%E7%8B%AC%E8%A7%92%E5%85%BD/"/>
    <id>https://zhangshuqiao.org/2019-01/成功召唤独角兽/</id>
    <published>2019-01-02T17:30:28.000Z</published>
    <updated>2019-02-05T10:32:30.880Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/2019-01/Unicorn.png" alt=""></p><blockquote><p>当你的代码出现未定义行为时，你会得到一个<code>segmentation fault</code>和一堆损坏的数据。当Jeff Dean的代码出现未定义行为时，一个独角兽会踏着彩虹从天而降并给每个人提供免费的冰激凌。</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/2019-01/Unicorn.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;当你的代码出现未定义行为时，你会得到一个&lt;code&gt;segmentation fault&lt;/code&gt;和一堆损坏的数据。当Jeff Dean
      
    
    </summary>
    
      <category term="幽默" scheme="https://zhangshuqiao.org/categories/%E5%B9%BD%E9%BB%98/"/>
    
    
      <category term="GitHub" scheme="https://zhangshuqiao.org/tags/GitHub/"/>
    
  </entry>
  
  <entry>
    <title>炉石卡组代码解析</title>
    <link href="https://zhangshuqiao.org/2018-12/%E7%82%89%E7%9F%B3%E5%8D%A1%E7%BB%84%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>https://zhangshuqiao.org/2018-12/炉石卡组代码解析/</id>
    <published>2018-12-22T13:51:38.000Z</published>
    <updated>2019-02-13T23:50:32.965Z</updated>
    
    <content type="html"><![CDATA[<p>在前面的文章<a href="/2018-12/Base64编码的原理与实现/">Base64编码的原理与实现</a>中，讲到了Base64编码的诸多用处，例如编码图片以嵌入HTML代码。如果你对此有所了解，同时还是一个炉石玩家，就不难发现，暴雪推出的卡组代码功能，本质上就是用一个Base64编码的字符串来存储卡组信息。毕竟，你有时会见到以<code>=</code>或者<code>==</code>结尾的卡组代码，这正是Base64编码的典型特征。</p><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>当把卡组代码粘贴到炉石传说时，客户端将忽略以<code>#</code>字符开头的任何行，这就提供了在卡组代码中插入注释的可能性。一个例外是在卡组代码最前面的，以<code>###</code>开头的第一行。如果可以的话，它将被用作套牌名称。你可以从炉石中复制一套卡组到文本编辑器看看效果。<br>没有被注释的那一行，包含了除套牌名称外的所有信息。玩家在各大论坛、社区分享卡组时，也往往只需要这一行卡组代码。</p><h2 id="DBF-ID"><a href="#DBF-ID" class="headerlink" title="DBF ID"></a>DBF ID</h2><p>为了了解编码的机制，我们需要先介绍DBF ID。这是每张炉石卡牌（包括可收集卡牌、衍生卡牌、冒险模式专属卡牌、英雄皮肤等）的唯一标识符——是的，这也是能够卡出下图这种BUG的原因。皮肤被标记为了一张紫卡。</p><p><img src="/images/2018-12/tyrande.png" alt=""></p><p>而炉石卡组代码正是使用DBF ID来表示每张卡牌。DBF ID可在游戏文件中找到。更加方便的方法是通过<a href="https://hearthstonejson.com" target="_blank" rel="noopener">HearthstoneJSON</a>，这上面提供了相关API。你也可以在这个网站上直接下载最新的<code>cards.collectible.json</code>，这里面包含了所有可收集卡牌的信息，例如各种语言的卡牌名称、描述等。</p><h2 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h2><p><strong>除非另有说明，否则后面的每个值都是一个整数，编码为无符号的<a href="https://en.wikipedia.org/wiki/Variable-length_quantity" target="_blank" rel="noopener">varint</a>。</strong><br>如前所述，卡组代码是Base64编码的字节串。我们先来解码它。许多编程语言都可以做到这一点，以最好的语言$PHP为例：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$deckstring = <span class="string">"AAEBAaoIBJsDoxTCrgLBiQMN/gXiDP8P5hausAKlvgL4vwL5vwKW7wKm7wKMhQPzigP2igMA"</span>;</span><br><span class="line"><span class="comment">#这是一个非常有趣的萨满卡组</span></span><br><span class="line">$binary = base64_decode($deckstring);</span><br><span class="line">$hex = bin2hex($binary);</span><br><span class="line"><span class="comment">#对于这个卡组，$hex="00010101aa08049b03a314c2ae02c189030dfe05e20cff0fe616aeb002a5be02f8bf02f9bf0296ef02a6ef028c8503f38a03f68a0300"</span></span><br></pre></td></tr></table></figure></p><p>这样就能得到初步解码后的十六进制字符串。如果你不是很擅长编程，也可以搜索一些现成的Base64解码工具，看看它是如何工作的。<br>将这个十六进制字符串按每两个元素切割，再把它们从16进制字符串转化为整型。也就是说，它们可以是00-ff，即0-255。一种实现的方法是这样：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$arr = str_split($hex, <span class="number">2</span>);</span><br><span class="line">$arr = array_map(<span class="string">"hexdec"</span>, $arr);</span><br></pre></td></tr></table></figure></p><p><code>$arr</code>是一个由整数组成的数组。更具体的来说，就是varint。我们还需要进一步的解码，才能读取出有用的信息：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read_varint</span><span class="params">(&amp;$data)</span> </span>&#123;</span><br><span class="line">    $shift = <span class="number">0</span>;</span><br><span class="line">    $result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        $c = array_shift($data);</span><br><span class="line">        $result |= ($c &amp; <span class="number">0x7f</span>) &lt;&lt; $shift;</span><br><span class="line">        $shift += <span class="number">7</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ($c &amp; <span class="number">0x80</span>);</span><br><span class="line">    <span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这里的<code>array_shift</code>会将数组的第一个元素移出数组，并返回它的值。在其它的编程语言中，类似的方法可能被叫做<code>lpop</code>，<code>pop</code>，<code>shift</code>等等。而<code>|</code>，<code>&amp;</code>，<code>&lt;&lt;</code>等都是位运算的运算符。<code>read_varint</code>函数完成了解码过程，如果有兴趣的话可以试试用C或Python实现它。<br>不断地执行<code>read_varint($arr)</code>，直到取完<code>$arr</code>中的元素，就能把内容全部解码出来。</p><p>根据作用，我们可以把解码后的卡组代码分为两个部分：元数据块和卡牌块。</p><a id="more"></a><h3 id="元数据块"><a href="#元数据块" class="headerlink" title="元数据块"></a>元数据块</h3><p>在<code>$arr</code>中，前五个元素分别为：</p><ul><li>保留字节0x00</li><li>版本号（固定为1）</li><li>模式（1为狂野，2为标准）</li><li>使用英雄卡牌的数量（固定为1）</li><li>使用的英雄卡牌的类型（长度不确定，一般是1-3位）</li></ul><p>可见卡组代码以字节0x00开头。然后是编码版本号，目前始终为1。虽然这五个元素并没有官方名称，不过从作用上可以看作元数据。<br>还有一点是，所谓『英雄卡牌的类型』就是你所使用的英雄皮肤。这个参数必不可少。英雄的职业决定了套牌所用的职业，但是套牌表面上是为英雄制作的，而不是为一个职业。如果卡组代码指定的英雄是皮肤而不是默认的英雄，那么在你复制卡组时，系统就会选择使用皮肤而不是默认英雄（前提是你买了这个皮肤）。<br><strong>关于英雄的注意事项：</strong>尽管它是一个数组，但它是用于<em>初始英雄</em>，而不是<em>可打出的英雄牌</em>（如冰封王座的DK）。</p><h3 id="卡牌块"><a href="#卡牌块" class="headerlink" title="卡牌块"></a>卡牌块</h3><p>在元数据块之后，继续读取<code>$arr</code>的元素，那么接下来就轮到卡牌块了。它按以下顺序分为三对长度+数组的组合：</p><ul><li>卡组中存在一张的卡</li><li>卡组中存在两张的卡</li><li>卡组中存在n张的卡</li></ul><p><strong>每对都有一个前导varint，指定数组中的项目数。</strong>这种结构的目标是使卡组代码尽可能紧凑。<strong>如前所述，每张卡都用varint型的DBF ID表示。</strong></p><p>所谓『卡组中存在n张的卡』，指的是卡组中的所有其他卡牌。此数组是一个varint对组成的列表，每一对的第一个元素表示DBF ID，第二个元素是该卡牌在卡组中出现的次数。它<strong>应该</strong>只包含在牌组中至少出现三次的牌，因而意味着它（在这种情况下）对于构筑卡组应当是空的（毕竟一张卡至多只能带两张）；但理论上它也可以包含有一张的卡和有两张的卡。</p><p>尽管最终排序无关紧要，但卡牌仍会在各自所在的数组中，按DBF ID的升序进行排序，以便始终为相同的卡组生成相同的卡组代码。我们称所有按照这种方式排列卡牌列表（包括英雄）的卡组代码为规范的卡组代码。下面的参考实现应该已经可以生成规范的卡组代码。</p><h2 id="一种实现"><a href="#一种实现" class="headerlink" title="一种实现"></a>一种实现</h2><p>看代码可能比文字描述更加直观。下面的<code>parse_deck()</code>函数就会按照前面介绍的方法，依次读取元数据块和卡牌块的信息。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parse_deck</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">    $reserve = read_varint($data);</span><br><span class="line">    <span class="keyword">if</span> ($reserve != <span class="number">0</span>) &#123;</span><br><span class="line">        printf(<span class="string">"Invalid deckstring"</span>);</span><br><span class="line">        <span class="keyword">die</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $version = read_varint($data);</span><br><span class="line">    <span class="keyword">if</span> ($version != <span class="number">1</span>) &#123;</span><br><span class="line">        printf(<span class="string">"Unsupported deckstring version %s"</span>, $version);</span><br><span class="line">        <span class="keyword">die</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    $format = read_varint($data);</span><br><span class="line">    $heroes = [];</span><br><span class="line">    $num_heroes = read_varint($data);</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $num_heroes; $i++) &#123;</span><br><span class="line">        $heroes[] = read_varint($data);</span><br><span class="line">    &#125;</span><br><span class="line">    $cards = [];</span><br><span class="line">    $num_cards_x1 = read_varint($data);</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $num_cards_x1; $i++) &#123;</span><br><span class="line">        $card_id = read_varint($data);</span><br><span class="line">        $cards[] = [$card_id, <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    $num_cards_x2 = read_varint($data);</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $num_cards_x2; $i++) &#123;</span><br><span class="line">        $card_id = read_varint($data);</span><br><span class="line">        $cards[] = [$card_id, <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    $num_cards_xn = read_varint($data);</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $num_cards_xn; $i++) &#123;</span><br><span class="line">        $card_id = read_varint($data);</span><br><span class="line">        $count = read_varint($data);</span><br><span class="line">        $cards[] = [$card_id, $count];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [$cards, $heroes, $format];</span><br><span class="line">&#125;</span><br><span class="line">parse_deck($arr);</span><br></pre></td></tr></table></figure></p><p>这时，再通过建立DBF ID与卡牌对应关系的数据库，就能够实现在游戏外导入、导出和编辑卡组的功能了。不论是官方的<a href="https://hs.blizzard.cn/cards" target="_blank" rel="noopener">卡牌工具</a>，还是第三方平台（如旅法师营地）的<a href="https://www.iyingdi.com/web/tools/hearthstone/decks" target="_blank" rel="noopener">套牌编辑</a>功能，原理都是相似的。<br>所有代码已开源：<a href="https://github.com/stevenjoezhang/hearthstone-deck" target="_blank" rel="noopener">Hearthstone-Deck</a><br>其他语言的实现方式可以在<a href="https://github.com/HearthSim" target="_blank" rel="noopener">HearthSim</a>的官方GitHub账户下找到。</p><hr><p>博主搭建的API：<a href="https://api.galaxymimi.com/deck/" target="_blank" rel="noopener">炉石传说卡组</a></p><p>拓展阅读：<br><a href="https://2heng.xin/2018/12/12/embed-hearthstone-deck-with-iframe" target="_blank" rel="noopener">在网页上展示你的炉石卡组吧</a><br><a href="https://www.darkerror.com/2018/05/hearth-stone-deck-string-decoding" target="_blank" rel="noopener">炉石传说卡组代码生成机制</a><br><a href="https://hearthsim.info/docs/deckstrings" target="_blank" rel="noopener">Hearthstone Deckstrings</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在前面的文章&lt;a href=&quot;/2018-12/Base64编码的原理与实现/&quot;&gt;Base64编码的原理与实现&lt;/a&gt;中，讲到了Base64编码的诸多用处，例如编码图片以嵌入HTML代码。如果你对此有所了解，同时还是一个炉石玩家，就不难发现，暴雪推出的卡组代码功能，本质上就是用一个Base64编码的字符串来存储卡组信息。毕竟，你有时会见到以&lt;code&gt;=&lt;/code&gt;或者&lt;code&gt;==&lt;/code&gt;结尾的卡组代码，这正是Base64编码的典型特征。&lt;/p&gt;
&lt;h2 id=&quot;注释&quot;&gt;&lt;a href=&quot;#注释&quot; class=&quot;headerlink&quot; title=&quot;注释&quot;&gt;&lt;/a&gt;注释&lt;/h2&gt;&lt;p&gt;当把卡组代码粘贴到炉石传说时，客户端将忽略以&lt;code&gt;#&lt;/code&gt;字符开头的任何行，这就提供了在卡组代码中插入注释的可能性。一个例外是在卡组代码最前面的，以&lt;code&gt;###&lt;/code&gt;开头的第一行。如果可以的话，它将被用作套牌名称。你可以从炉石中复制一套卡组到文本编辑器看看效果。&lt;br&gt;没有被注释的那一行，包含了除套牌名称外的所有信息。玩家在各大论坛、社区分享卡组时，也往往只需要这一行卡组代码。&lt;/p&gt;
&lt;h2 id=&quot;DBF-ID&quot;&gt;&lt;a href=&quot;#DBF-ID&quot; class=&quot;headerlink&quot; title=&quot;DBF ID&quot;&gt;&lt;/a&gt;DBF ID&lt;/h2&gt;&lt;p&gt;为了了解编码的机制，我们需要先介绍DBF ID。这是每张炉石卡牌（包括可收集卡牌、衍生卡牌、冒险模式专属卡牌、英雄皮肤等）的唯一标识符——是的，这也是能够卡出下图这种BUG的原因。皮肤被标记为了一张紫卡。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2018-12/tyrande.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;而炉石卡组代码正是使用DBF ID来表示每张卡牌。DBF ID可在游戏文件中找到。更加方便的方法是通过&lt;a href=&quot;https://hearthstonejson.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;HearthstoneJSON&lt;/a&gt;，这上面提供了相关API。你也可以在这个网站上直接下载最新的&lt;code&gt;cards.collectible.json&lt;/code&gt;，这里面包含了所有可收集卡牌的信息，例如各种语言的卡牌名称、描述等。&lt;/p&gt;
&lt;h2 id=&quot;格式&quot;&gt;&lt;a href=&quot;#格式&quot; class=&quot;headerlink&quot; title=&quot;格式&quot;&gt;&lt;/a&gt;格式&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;除非另有说明，否则后面的每个值都是一个整数，编码为无符号的&lt;a href=&quot;https://en.wikipedia.org/wiki/Variable-length_quantity&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;varint&lt;/a&gt;。&lt;/strong&gt;&lt;br&gt;如前所述，卡组代码是Base64编码的字节串。我们先来解码它。许多编程语言都可以做到这一点，以最好的语言$PHP为例：&lt;br&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$deckstring = &lt;span class=&quot;string&quot;&gt;&quot;AAEBAaoIBJsDoxTCrgLBiQMN/gXiDP8P5hausAKlvgL4vwL5vwKW7wKm7wKMhQPzigP2igMA&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#这是一个非常有趣的萨满卡组&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$binary = base64_decode($deckstring);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$hex = bin2hex($binary);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#对于这个卡组，$hex=&quot;00010101aa08049b03a314c2ae02c189030dfe05e20cff0fe616aeb002a5be02f8bf02f9bf0296ef02a6ef028c8503f38a03f68a0300&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这样就能得到初步解码后的十六进制字符串。如果你不是很擅长编程，也可以搜索一些现成的Base64解码工具，看看它是如何工作的。&lt;br&gt;将这个十六进制字符串按每两个元素切割，再把它们从16进制字符串转化为整型。也就是说，它们可以是00-ff，即0-255。一种实现的方法是这样：&lt;br&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$arr = str_split($hex, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$arr = array_map(&lt;span class=&quot;string&quot;&gt;&quot;hexdec&quot;&lt;/span&gt;, $arr);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$arr&lt;/code&gt;是一个由整数组成的数组。更具体的来说，就是varint。我们还需要进一步的解码，才能读取出有用的信息：&lt;br&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;read_varint&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&amp;amp;$data)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    $shift = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    $result = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        $c = array_shift($data);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        $result |= ($c &amp;amp; &lt;span class=&quot;number&quot;&gt;0x7f&lt;/span&gt;) &amp;lt;&amp;lt; $shift;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        $shift += &lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; ($c &amp;amp; &lt;span class=&quot;number&quot;&gt;0x80&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; $result;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这里的&lt;code&gt;array_shift&lt;/code&gt;会将数组的第一个元素移出数组，并返回它的值。在其它的编程语言中，类似的方法可能被叫做&lt;code&gt;lpop&lt;/code&gt;，&lt;code&gt;pop&lt;/code&gt;，&lt;code&gt;shift&lt;/code&gt;等等。而&lt;code&gt;|&lt;/code&gt;，&lt;code&gt;&amp;amp;&lt;/code&gt;，&lt;code&gt;&amp;lt;&amp;lt;&lt;/code&gt;等都是位运算的运算符。&lt;code&gt;read_varint&lt;/code&gt;函数完成了解码过程，如果有兴趣的话可以试试用C或Python实现它。&lt;br&gt;不断地执行&lt;code&gt;read_varint($arr)&lt;/code&gt;，直到取完&lt;code&gt;$arr&lt;/code&gt;中的元素，就能把内容全部解码出来。&lt;/p&gt;
&lt;p&gt;根据作用，我们可以把解码后的卡组代码分为两个部分：元数据块和卡牌块。&lt;/p&gt;
    
    </summary>
    
      <category term="电子游戏" scheme="https://zhangshuqiao.org/categories/%E7%94%B5%E5%AD%90%E6%B8%B8%E6%88%8F/"/>
    
    
      <category term="PHP" scheme="https://zhangshuqiao.org/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>Command Line Russian Roulette</title>
    <link href="https://zhangshuqiao.org/2018-12/Command%20Line%20Russian%20Roulette/"/>
    <id>https://zhangshuqiao.org/2018-12/Command Line Russian Roulette/</id>
    <published>2018-12-16T08:58:38.000Z</published>
    <updated>2019-02-05T10:32:30.865Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/2018-12/Strip-Roulette-russe-650-finalenglish.jpg" alt=""></p><p>图片来源：<a href="http://www.commitstrip.com/en/2014/05/16/russian-roulette" target="_blank" rel="noopener">Russian roulette</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/2018-12/Strip-Roulette-russe-650-finalenglish.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;图片来源：&lt;a href=&quot;http://www.commitstrip.com/en/2014/05/1
      
    
    </summary>
    
      <category term="幽默" scheme="https://zhangshuqiao.org/categories/%E5%B9%BD%E9%BB%98/"/>
    
    
  </entry>
  
  <entry>
    <title>Base64编码的原理与实现</title>
    <link href="https://zhangshuqiao.org/2018-12/Base64%E7%BC%96%E7%A0%81%E7%9A%84%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
    <id>https://zhangshuqiao.org/2018-12/Base64编码的原理与实现/</id>
    <published>2018-12-12T05:21:01.000Z</published>
    <updated>2019-03-13T15:57:37.745Z</updated>
    
    <content type="html"><![CDATA[<p>在数据传输的时候，并不是所有的字符都可以受到支持，很多时候只能传输可见字符，对于不可见字符的传输需要经过特殊处理，这就是Base64产生的原因。Base64编码是一种基于64个可打印字符来表示二进制数据的表示方法。由于$2^6=64$，所以每6个比特为一个单元，对应某个可打印字符。3个字节有24个比特，对应于4个Base64单元，即3个字节可由4个可打印字符来表示。在Base64中的可打印字符包括字母A-Z、a-z、数字0-9，这样共有62个字符，此外两个可打印符号在不同的系统中而不同。一些如uuencode的其他编码方法，和之后BinHex的版本使用不同的64字符集来代表6个二进制数字，但是不被称为Base64。<br>Base64常用于在通常处理文本数据的场合，表示、传输、存储一些二进制数据，包括MIME的电子邮件及XML的一些复杂数据。用Base64编码图片也是互联网上常见的做法。</p><p>Base64的字符索引如下表所示：</p><table><thead><tr><th>数值</th><th>字符</th><th>数值</th><th>字符</th><th>数值</th><th>字符</th><th>数值</th><th>字符</th></tr></thead><tbody><tr><td>0</td><td>A</td><td>16</td><td>Q</td><td>32</td><td>g</td><td>48</td><td>w</td></tr><tr><td>1</td><td>B</td><td>17</td><td>R</td><td>33</td><td>h</td><td>49</td><td>x</td></tr><tr><td>2</td><td>C</td><td>18</td><td>S</td><td>34</td><td>i</td><td>50</td><td>y</td></tr><tr><td>3</td><td>D</td><td>19</td><td>T</td><td>35</td><td>j</td><td>51</td><td>z</td></tr><tr><td>4</td><td>E</td><td>20</td><td>U</td><td>36</td><td>k</td><td>52</td><td>0</td></tr><tr><td>5</td><td>F</td><td>21</td><td>V</td><td>37</td><td>l</td><td>53</td><td>1</td></tr><tr><td>6</td><td>G</td><td>22</td><td>W</td><td>38</td><td>m</td><td>54</td><td>2</td></tr><tr><td>7</td><td>H</td><td>23</td><td>X</td><td>39</td><td>n</td><td>55</td><td>3</td></tr><tr><td>8</td><td>I</td><td>24</td><td>Y</td><td>40</td><td>o</td><td>56</td><td>4</td></tr><tr><td>9</td><td>J</td><td>25</td><td>Z</td><td>41</td><td>p</td><td>57</td><td>5</td></tr><tr><td>10</td><td>K</td><td>26</td><td>a</td><td>42</td><td>q</td><td>58</td><td>6</td></tr><tr><td>11</td><td>L</td><td>27</td><td>b</td><td>43</td><td>r</td><td>59</td><td>7</td></tr><tr><td>12</td><td>M</td><td>28</td><td>c</td><td>44</td><td>s</td><td>60</td><td>8</td></tr><tr><td>13</td><td>N</td><td>29</td><td>d</td><td>45</td><td>t</td><td>61</td><td>9</td></tr><tr><td>14</td><td>O</td><td>30</td><td>e</td><td>46</td><td>u</td><td>62</td><td>+</td></tr><tr><td>15</td><td>P</td><td>31</td><td>f</td><td>47</td><td>v</td><td>63</td><td>/</td></tr></tbody></table><p>这是一个根据上表进行编码的例子：</p><p><img src="/images/2018-12/1.png" alt=""></p><p>如果要编码的字节数不能被3整除，最后会多出1个或2个字节，那么可以使用下面的方法进行处理：先使用0字节值在末尾补足，使其能够被3整除，然后再进行Base64的编码。在编码后的Base64文本后加上一个或两个=号，代表补足的字节数。也就是说，当最后剩余两个八位字节（2个byte）时，最后一个6位的Base64字节块有四位是0值，最后附加上两个等号；如果最后剩余一个八位字节（1个byte）时，最后一个6位的Base字节块有两位是0值，最后附加一个等号。可以参考下面的例子：</p><p><img src="/images/2018-12/2.png" alt=""></p><a id="more"></a><p>这是一个用Python实现Base64编码的脚本：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myBase64Encode</span><span class="params">(preCoding)</span>:</span></span><br><span class="line">    charTable = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span> <span class="comment">#字符表</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> len(preCoding) &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>  <span class="comment">#字符串为空则返回空</span></span><br><span class="line">    lackCharNums = <span class="number">3</span> - len(preCoding) % <span class="number">3</span></span><br><span class="line">    <span class="keyword">if</span> lackCharNums == <span class="number">3</span> : lackCharNums = <span class="number">0</span> <span class="comment">#整除说明不缺字符</span></span><br><span class="line">    <span class="comment">#待转换字符不是3的倍数的情况补全它</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(lackCharNums) :</span><br><span class="line">        preCoding = preCoding + <span class="string">b'\x00'</span></span><br><span class="line">    result = <span class="string">''</span> <span class="comment">#用于保存最终结果的str数据</span></span><br><span class="line">    rp = <span class="string">''</span> <span class="comment">#处理补全字符时的暂存变量</span></span><br><span class="line">    <span class="comment">#每三个字符处理一轮</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(int(len(preCoding) / <span class="number">3</span>)):</span><br><span class="line">        threeChar = preCoding[i * <span class="number">3</span> : i * <span class="number">3</span> + <span class="number">3</span>] <span class="comment">#取三个字符出来</span></span><br><span class="line">        tCode = <span class="string">''</span> <span class="comment">#用于存放三个字符拼接后的二进制数值 文本形式</span></span><br><span class="line">        pCode = <span class="string">''</span> <span class="comment">#暂存变量</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">3</span>) :</span><br><span class="line">            pCode = bin(threeChar[j])[<span class="number">2</span> :]  <span class="comment">#把省略的0补上</span></span><br><span class="line">            lackZeroNums = <span class="number">8</span> - len(pCode) <span class="comment">#省略的0的个数</span></span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> range(lackZeroNums):</span><br><span class="line">                pCode = <span class="string">'0'</span> + pCode</span><br><span class="line">            tCode = tCode + pCode</span><br><span class="line">        pCode = <span class="string">''</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>): <span class="comment">#每6位一个字符</span></span><br><span class="line">            pCode = tCode[j * <span class="number">6</span> : j * <span class="number">6</span> + <span class="number">6</span>]</span><br><span class="line">            rp = rp + charTable[int(pCode, <span class="number">2</span>)]</span><br><span class="line">        <span class="comment">#处理补全的00字符</span></span><br><span class="line">        result = rp[: len(rp) - lackCharNums]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(lackCharNums):</span><br><span class="line">            result = result + <span class="string">'='</span></span><br><span class="line">    <span class="keyword">return</span> bytes(result, encoding = <span class="string">"utf-8"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myBase64Decode</span><span class="params">(encodedBin)</span> :</span></span><br><span class="line">    charTable = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span> <span class="comment">#字符表</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">#如果字符不是4的倍数 返回空</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> len(encodedBin) % <span class="number">4</span> == <span class="number">0</span> :</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line"> </span><br><span class="line">    tCode = <span class="string">''</span> <span class="comment">#用于存放最终的二进制文本字符串</span></span><br><span class="line">    pCpde = <span class="string">''</span> <span class="comment">#暂存变量</span></span><br><span class="line">    <span class="comment">#遍历encodedBin每一个字符</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> encodedBin:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(len(charTable)): <span class="comment">#找到表中对应坐标</span></span><br><span class="line">            <span class="keyword">if</span> chr(i) == charTable[j]:</span><br><span class="line">                pCode = bin(j)[<span class="number">2</span> :]  <span class="comment">#转二进制去除开头的0b</span></span><br><span class="line">                lackZeroNums = <span class="number">6</span> - len(pCode) <span class="comment">#省略的0的个数</span></span><br><span class="line">                <span class="keyword">for</span> x <span class="keyword">in</span> range(lackZeroNums):</span><br><span class="line">                    pCode = <span class="string">'0'</span> + pCode</span><br><span class="line">                tCode = tCode + pCode</span><br><span class="line">    pCode = <span class="string">''</span></span><br><span class="line">    result = <span class="string">''</span> <span class="comment">#储存最终结果</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(int(len(tCode) / <span class="number">8</span>)):</span><br><span class="line">        pCode = tCode[i * <span class="number">8</span> : i * <span class="number">8</span> + <span class="number">8</span>]</span><br><span class="line">        result = result + chr(int(pCode, <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> bytes(result, encoding = <span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line">print(myBase64Encode(<span class="string">b"helloworld"</span>))</span><br><span class="line">print(myBase64Decode(<span class="string">b"aGVsbG93b3JsZA=="</span>))</span><br></pre></td></tr></table></figure></p><p>浏览器中可以直接调用相关的API：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>文件base64——直接拖进来<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">body &#123;</span></span><br><span class="line"><span class="undefined">    word-break: break-all;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.addEventListener(<span class="string">"dragenter"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">    event.preventDefault();</span></span><br><span class="line"><span class="actionscript">&#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.addEventListener(<span class="string">"dragover"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">    event.preventDefault();</span></span><br><span class="line"><span class="actionscript">&#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.addEventListener(<span class="string">"drop"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="actionscript">    reader.onload = <span class="function"><span class="keyword">function</span><span class="params">(e)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.body.insertAdjacentHTML(<span class="string">"afterBegin"</span>, <span class="string">'&lt;p&gt;'</span> + e.target.result + <span class="string">'&lt;/p&gt;'</span>); </span></span><br><span class="line"><span class="actionscript">        <span class="comment">//base64 encoded file data!</span></span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined">    reader.readAsDataURL(event.dataTransfer.files[0]);</span></span><br><span class="line"><span class="undefined">    event.preventDefault();</span></span><br><span class="line"><span class="actionscript">&#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>这是加载Base64编码的图片的方法。这可以将图片硬编码到网页中。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Base64 Encode编码实现1x1px透明(黑白)图片<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">body &#123;</span></span><br><span class="line"><span class="undefined">    text-align: center;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>以下是透明图片<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"</span> <span class="attr">width</span>=<span class="string">"500"</span> <span class="attr">height</span>=<span class="string">"100"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>以下是黑色图片<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs="</span> <span class="attr">width</span>=<span class="string">"500"</span> <span class="attr">height</span>=<span class="string">"100"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><hr><p>拓展阅读：<br><a href="https://zh.wikipedia.org/wiki/Base64" target="_blank" rel="noopener">Base64 - 维基百科</a><br><a href="https://www.52pojie.cn/thread-831202-1-1.html" target="_blank" rel="noopener">Base64编码原理及脚本的简单实现</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在数据传输的时候，并不是所有的字符都可以受到支持，很多时候只能传输可见字符，对于不可见字符的传输需要经过特殊处理，这就是Base64产生的原因。Base64编码是一种基于64个可打印字符来表示二进制数据的表示方法。由于$2^6=64$，所以每6个比特为一个单元，对应某个可打印字符。3个字节有24个比特，对应于4个Base64单元，即3个字节可由4个可打印字符来表示。在Base64中的可打印字符包括字母A-Z、a-z、数字0-9，这样共有62个字符，此外两个可打印符号在不同的系统中而不同。一些如uuencode的其他编码方法，和之后BinHex的版本使用不同的64字符集来代表6个二进制数字，但是不被称为Base64。&lt;br&gt;Base64常用于在通常处理文本数据的场合，表示、传输、存储一些二进制数据，包括MIME的电子邮件及XML的一些复杂数据。用Base64编码图片也是互联网上常见的做法。&lt;/p&gt;
&lt;p&gt;Base64的字符索引如下表所示：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;数值&lt;/th&gt;
&lt;th&gt;字符&lt;/th&gt;
&lt;th&gt;数值&lt;/th&gt;
&lt;th&gt;字符&lt;/th&gt;
&lt;th&gt;数值&lt;/th&gt;
&lt;th&gt;字符&lt;/th&gt;
&lt;th&gt;数值&lt;/th&gt;
&lt;th&gt;字符&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;A&lt;/td&gt;
&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;Q&lt;/td&gt;
&lt;td&gt;32&lt;/td&gt;
&lt;td&gt;g&lt;/td&gt;
&lt;td&gt;48&lt;/td&gt;
&lt;td&gt;w&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;B&lt;/td&gt;
&lt;td&gt;17&lt;/td&gt;
&lt;td&gt;R&lt;/td&gt;
&lt;td&gt;33&lt;/td&gt;
&lt;td&gt;h&lt;/td&gt;
&lt;td&gt;49&lt;/td&gt;
&lt;td&gt;x&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;C&lt;/td&gt;
&lt;td&gt;18&lt;/td&gt;
&lt;td&gt;S&lt;/td&gt;
&lt;td&gt;34&lt;/td&gt;
&lt;td&gt;i&lt;/td&gt;
&lt;td&gt;50&lt;/td&gt;
&lt;td&gt;y&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;D&lt;/td&gt;
&lt;td&gt;19&lt;/td&gt;
&lt;td&gt;T&lt;/td&gt;
&lt;td&gt;35&lt;/td&gt;
&lt;td&gt;j&lt;/td&gt;
&lt;td&gt;51&lt;/td&gt;
&lt;td&gt;z&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;E&lt;/td&gt;
&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;U&lt;/td&gt;
&lt;td&gt;36&lt;/td&gt;
&lt;td&gt;k&lt;/td&gt;
&lt;td&gt;52&lt;/td&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;F&lt;/td&gt;
&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;V&lt;/td&gt;
&lt;td&gt;37&lt;/td&gt;
&lt;td&gt;l&lt;/td&gt;
&lt;td&gt;53&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;G&lt;/td&gt;
&lt;td&gt;22&lt;/td&gt;
&lt;td&gt;W&lt;/td&gt;
&lt;td&gt;38&lt;/td&gt;
&lt;td&gt;m&lt;/td&gt;
&lt;td&gt;54&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;H&lt;/td&gt;
&lt;td&gt;23&lt;/td&gt;
&lt;td&gt;X&lt;/td&gt;
&lt;td&gt;39&lt;/td&gt;
&lt;td&gt;n&lt;/td&gt;
&lt;td&gt;55&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;I&lt;/td&gt;
&lt;td&gt;24&lt;/td&gt;
&lt;td&gt;Y&lt;/td&gt;
&lt;td&gt;40&lt;/td&gt;
&lt;td&gt;o&lt;/td&gt;
&lt;td&gt;56&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;J&lt;/td&gt;
&lt;td&gt;25&lt;/td&gt;
&lt;td&gt;Z&lt;/td&gt;
&lt;td&gt;41&lt;/td&gt;
&lt;td&gt;p&lt;/td&gt;
&lt;td&gt;57&lt;/td&gt;
&lt;td&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;K&lt;/td&gt;
&lt;td&gt;26&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;42&lt;/td&gt;
&lt;td&gt;q&lt;/td&gt;
&lt;td&gt;58&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;11&lt;/td&gt;
&lt;td&gt;L&lt;/td&gt;
&lt;td&gt;27&lt;/td&gt;
&lt;td&gt;b&lt;/td&gt;
&lt;td&gt;43&lt;/td&gt;
&lt;td&gt;r&lt;/td&gt;
&lt;td&gt;59&lt;/td&gt;
&lt;td&gt;7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;M&lt;/td&gt;
&lt;td&gt;28&lt;/td&gt;
&lt;td&gt;c&lt;/td&gt;
&lt;td&gt;44&lt;/td&gt;
&lt;td&gt;s&lt;/td&gt;
&lt;td&gt;60&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;13&lt;/td&gt;
&lt;td&gt;N&lt;/td&gt;
&lt;td&gt;29&lt;/td&gt;
&lt;td&gt;d&lt;/td&gt;
&lt;td&gt;45&lt;/td&gt;
&lt;td&gt;t&lt;/td&gt;
&lt;td&gt;61&lt;/td&gt;
&lt;td&gt;9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;14&lt;/td&gt;
&lt;td&gt;O&lt;/td&gt;
&lt;td&gt;30&lt;/td&gt;
&lt;td&gt;e&lt;/td&gt;
&lt;td&gt;46&lt;/td&gt;
&lt;td&gt;u&lt;/td&gt;
&lt;td&gt;62&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;15&lt;/td&gt;
&lt;td&gt;P&lt;/td&gt;
&lt;td&gt;31&lt;/td&gt;
&lt;td&gt;f&lt;/td&gt;
&lt;td&gt;47&lt;/td&gt;
&lt;td&gt;v&lt;/td&gt;
&lt;td&gt;63&lt;/td&gt;
&lt;td&gt;/&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;这是一个根据上表进行编码的例子：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2018-12/1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;如果要编码的字节数不能被3整除，最后会多出1个或2个字节，那么可以使用下面的方法进行处理：先使用0字节值在末尾补足，使其能够被3整除，然后再进行Base64的编码。在编码后的Base64文本后加上一个或两个=号，代表补足的字节数。也就是说，当最后剩余两个八位字节（2个byte）时，最后一个6位的Base64字节块有四位是0值，最后附加上两个等号；如果最后剩余一个八位字节（1个byte）时，最后一个6位的Base字节块有两位是0值，最后附加一个等号。可以参考下面的例子：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2018-12/2.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="技术" scheme="https://zhangshuqiao.org/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Python" scheme="https://zhangshuqiao.org/tags/Python/"/>
    
      <category term="HTML" scheme="https://zhangshuqiao.org/tags/HTML/"/>
    
  </entry>
  
  <entry>
    <title>历史上的今天</title>
    <link href="https://zhangshuqiao.org/2018-12/%E5%8E%86%E5%8F%B2%E4%B8%8A%E7%9A%84%E4%BB%8A%E5%A4%A9/"/>
    <id>https://zhangshuqiao.org/2018-12/历史上的今天/</id>
    <published>2018-12-06T10:38:36.000Z</published>
    <updated>2019-02-12T03:44:44.812Z</updated>
    
    <content type="html"><![CDATA[<p>如果要在网页上显示一些随机的语句，获得一些人生的经验，你会选择什么？<br>也许，<a href="https://hitokoto.cn" target="_blank" rel="noopener">一言</a>是一个很好的选择，它可以提供一些动漫中的台词，或是网络上的各种小段子。<br>在前面的文章<a href="/2018-05/有趣的Linux命令行工具">有趣的Linux命令行工具</a>中提到的<code>fortune</code>命令或许也可以满足需求，<code>pure-ftpd</code>就可以设置在连接成功时显示随机的来自<code>fortune</code>的语句。<br>那除此之外呢？历史上的今天是一个不错的方案。当你访问一些门户网站的首页，有时会看到这样的栏目。它也是一些百科全书网站，比如维基百科的传统。事实上，在Mac上就自带了一个小型的『历史上的今天』数据库，执行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/share/calendar/calendar.history</span><br></pre></td></tr></table></figure></p><p>就可以看到。<br>这篇文章将介绍如何搭建一个提供『历史上的今天』信息的API。</p><h2 id="建立数据库"><a href="#建立数据库" class="headerlink" title="建立数据库"></a>建立数据库</h2><p>首先，建立MySQL数据库，用于存储爬取的信息。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> dbname;</span><br><span class="line">#建立数据库，dbname保持一致即可</span><br><span class="line"><span class="keyword">USE</span> dbname;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">event</span> (</span><br><span class="line">  <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> PRIMARY <span class="keyword">KEY</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="keyword">type</span> <span class="built_in">int</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="keyword">year</span> <span class="built_in">varchar</span>(<span class="number">6</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="built_in">date</span> <span class="built_in">varchar</span>(<span class="number">6</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  info <span class="built_in">varchar</span>(<span class="number">300</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line">QUIT;</span><br></pre></td></tr></table></figure></p><h2 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h2><p>数据来源是维基百科，使用Python爬取数据，并存入数据库中。代码中的<code>username</code>、<code>password</code>和<code>dbname</code>分别是你的登录用户名、密码和数据库名。数据表名默认是event，也可以自行修改。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">typeList = [<span class="string">"大事记"</span>, <span class="string">"出生"</span>, <span class="string">"逝世"</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">savedb</span><span class="params">(data)</span>:</span></span><br><span class="line">    conn = pymysql.connect(host = <span class="string">"127.0.0.1"</span>, user = <span class="string">"username"</span>, password = <span class="string">"password"</span>, db = <span class="string">"dbname"</span>, charset = <span class="string">"utf8"</span>)</span><br><span class="line">    print(conn)</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cur.execute(<span class="string">"insert into event values(null,%s,%s,%s,%s)"</span>, data)</span><br><span class="line">    <span class="keyword">except</span> pymysql.err.InternalError:</span><br><span class="line">        print(<span class="string">"\033[31mERROR: Incorrect string value.\033[0m"</span>, data)</span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">"failed.txt"</span>, <span class="string">"a"</span>) <span class="keyword">as</span> myfile:</span><br><span class="line">            myfile.write(str(data) + <span class="string">"\n"</span>)</span><br><span class="line">    <span class="keyword">except</span> pymysql.err.DataError:</span><br><span class="line">        print(<span class="string">"\033[31mERROR: Data too long.\033[0m"</span>, data)</span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">"failed.txt"</span>, <span class="string">"a"</span>) <span class="keyword">as</span> myfile:</span><br><span class="line">            myfile.write(str(data) + <span class="string">"\n"</span>)</span><br><span class="line">    cur.connection.commit()</span><br><span class="line">    cur.close()</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getDateList</span><span class="params">()</span>:</span></span><br><span class="line">    list = []</span><br><span class="line">    date = datetime.date(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">366</span>):</span><br><span class="line">        date_str = str(date.month) + <span class="string">"月"</span> + str(date.day) + <span class="string">"日"</span></span><br><span class="line">        list.append(date_str)</span><br><span class="line">        date += datetime.timedelta(days = <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> list</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getInfo</span><span class="params">(html, type, date)</span>:</span></span><br><span class="line">    flag = re.compile(<span class="string">"(&lt;h2&gt;&lt;span id=.*&lt;span class=\"mw-headline\" id=.*?"</span> + typeList[type] + <span class="string">"[\s\S]*?&lt;/ul&gt;\s*?)&lt;h2&gt;"</span>).search(html)</span><br><span class="line">    <span class="keyword">if</span> flag:</span><br><span class="line">        bsObj = BeautifulSoup(flag.group(<span class="number">1</span>), <span class="string">"html.parser"</span>).findAll(<span class="string">"li"</span>)</span><br><span class="line">        <span class="keyword">for</span> li <span class="keyword">in</span> bsObj:</span><br><span class="line">            match = re.compile(<span class="string">"((^前|^)\d&#123;1,4&#125;年)：([\s\S]*$)"</span>).match(li.get_text())</span><br><span class="line">            <span class="keyword">if</span> match:</span><br><span class="line">                year = match.group(<span class="number">1</span>)</span><br><span class="line">                info = re.sub(<span class="string">"\[\d&#123;1,&#125;\]"</span>, <span class="string">""</span>, match.group(<span class="number">3</span>).strip())</span><br><span class="line">                data = (type, year, date, info)</span><br><span class="line">                print(data)</span><br><span class="line">                savedb(data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    list = getDateList()</span><br><span class="line">    <span class="keyword">for</span> date <span class="keyword">in</span> list:</span><br><span class="line">        print(date)</span><br><span class="line">        url = <span class="string">"https://zh.wikipedia.org/zh-cn/%s"</span> % date</span><br><span class="line">        <span class="comment">#url = "https://api.galaxymimi.com/proxy/?url=https://zh.wikipedia.org/zh-cn/%s" % date</span></span><br><span class="line">        r = requests.get(url)</span><br><span class="line">        getInfo(r.text, <span class="number">0</span>, date)  <span class="comment"># 大事记</span></span><br><span class="line">        getInfo(r.text, <span class="number">1</span>, date)  <span class="comment"># 出生</span></span><br><span class="line">        getInfo(r.text, <span class="number">2</span>, date)  <span class="comment"># 逝世</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p><p>这里的两个<code>except</code>分别处理的是特殊字符（非UTF-8范围）和内容长度超出的问题。</p><h2 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h2><p>比较简单的方式是按照json格式进行输出，这里给出一种使用PHP的方案。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $mysqli = <span class="keyword">new</span> mysqli(<span class="string">"localhost"</span>, <span class="string">"username"</span>, <span class="string">"password"</span>, <span class="string">"dbname"</span>);</span><br><span class="line">    <span class="comment">/* 检查连接 */</span></span><br><span class="line">    <span class="keyword">if</span> (mysqli_connect_errno()) &#123;</span><br><span class="line">        printf(<span class="string">"Connect failed: %s\n"</span>, mysqli_connect_error());</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $date = $_GET[<span class="string">'date'</span>] ? $mysqli-&gt;real_escape_string($_GET[<span class="string">'date'</span>]) : date(<span class="string">"m月d日"</span>);</span><br><span class="line">    $type = $_GET[<span class="string">'type'</span>] ? (int)$mysqli-&gt;real_escape_string($_GET[<span class="string">'type'</span>]) : <span class="number">0</span>;</span><br><span class="line">    $count = $_GET[<span class="string">'count'</span>] ? (int)$mysqli-&gt;real_escape_string($_GET[<span class="string">'count'</span>]) : <span class="number">1</span>;</span><br><span class="line">    $result = <span class="keyword">array</span>();</span><br><span class="line">    <span class="comment">/* 创建一个预编译 SQL 语句 */</span></span><br><span class="line">    <span class="keyword">if</span> ($stmt = $mysqli-&gt;prepare(<span class="string">"select * from `event` where `date` = ? and `type` = ? order by RAND() limit ?"</span>)) &#123;</span><br><span class="line">        <span class="comment">/* 对于参数占位符进行参数值绑定 */</span></span><br><span class="line">        $stmt-&gt;bind_param(<span class="string">"dii"</span>, $date, $type, $count);</span><br><span class="line">        <span class="comment">/* 执行查询 */</span></span><br><span class="line">        $stmt-&gt;execute();</span><br><span class="line">        <span class="comment">/* 将查询结果绑定到变量 */</span></span><br><span class="line">        $stmt-&gt;bind_result($id, $type, $year, $date, $info);</span><br><span class="line">        <span class="comment">/* 获取查询结果值 */</span></span><br><span class="line">        <span class="keyword">while</span> ($stmt-&gt;fetch()) &#123;</span><br><span class="line">            $arr = <span class="keyword">array</span>(<span class="string">'year'</span> =&gt; $year, <span class="string">'info'</span> =&gt; $info);</span><br><span class="line">            $result[] = $arr;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">echo</span> json_encode($result, JSON_UNESCAPED_UNICODE);</span><br><span class="line">        <span class="comment">/* 关闭语句句柄 */</span></span><br><span class="line">        $stmt-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 关闭连接 */</span></span><br><span class="line">    $mysqli-&gt;close();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p><p>同样将<code>username</code>、<code>password</code>和<code>dbname</code>根据情况替换，就可以访问了。</p><hr><p>项目地址：<a href="https://github.com/stevenjoezhang/TodayInHistory-Crawler" target="_blank" rel="noopener">TodayInHistory-Crawler</a>，可以打包下载所有文件。</p><p>博主搭建的API：<a href="https://api.galaxymimi.com/today/?type=0" target="_blank" rel="noopener">历史上的今天</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;如果要在网页上显示一些随机的语句，获得一些人生的经验，你会选择什么？&lt;br&gt;也许，&lt;a href=&quot;https://hitokoto.cn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;一言&lt;/a&gt;是一个很好的选择，它可以提供一些动漫中的台词，或是网络上的
      
    
    </summary>
    
      <category term="程序设计" scheme="https://zhangshuqiao.org/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"/>
    
    
      <category term="Python" scheme="https://zhangshuqiao.org/tags/Python/"/>
    
      <category term="MySQL" scheme="https://zhangshuqiao.org/tags/MySQL/"/>
    
      <category term="PHP" scheme="https://zhangshuqiao.org/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>十二月天象</title>
    <link href="https://zhangshuqiao.org/2018-12/%E5%8D%81%E4%BA%8C%E6%9C%88%E5%A4%A9%E8%B1%A1/"/>
    <id>https://zhangshuqiao.org/2018-12/十二月天象/</id>
    <published>2018-12-02T12:11:36.000Z</published>
    <updated>2019-02-12T03:43:51.510Z</updated>
    
    <content type="html"><![CDATA[<p>即将到来的12月天宇将先后上演『金星最亮』『双子座流星雨极大』『水星西大距』和『小熊座流星雨极大』等多部天象大片，天文爱好者们千万不要错过。</p><h2 id="火星合海王星"><a href="#火星合海王星" class="headerlink" title="火星合海王星"></a>火星合海王星</h2><p>2018年12月7日入夜后西南方天空将可观赏到火星合海王星的天象，火星将至海王星北面0.04度（相当于2角分）的近距离通过，位于宝瓶座。火星视亮度+0.1等，海王星+7.9等，需用小型望远镜观测。</p><p><img src="/images/2018-12/mars.png" alt=""></p><h2 id="双子座流星雨极大期"><a href="#双子座流星雨极大期" class="headerlink" title="双子座流星雨极大期"></a>双子座流星雨极大期</h2><p>每到岁末，双子座流星雨（Geminids，00004 GEM）都会如期而至。作为北半球三大流星雨之一，它的流量非常稳定，并且全球绝大多数地区的公众都有机会观测到它。今年双子座流星雨的观测条件不错，预报的极大值出现在12月14日晚20时30分，天顶每时出现率ZHR为120。</p><p>辐射点在12月14日入夜后自东北偏东方升起，即入夜后就有机会见到双子座流星出现。今年月相接近上弦，但对观测影响不大，尤其是后半夜观测条件很好，但要注意防寒保暖。</p><p><img src="/images/2018-12/Comet_holmes_and_Geminid121307.jpg" alt=""></p><h2 id="水星西大距"><a href="#水星西大距" class="headerlink" title="水星西大距"></a>水星西大距</h2><p>12月15日，今年最后一次水星西大距将上演。如果大气透明度足够高，在此后几天的日出前，用肉眼或借助双筒望远镜均可在黎明前的东方低空寻觅到水星的神秘身影。</p><p><img src="/images/2018-12/mercury.png" alt=""></p><p>水星的视运动是这样的：东大距 → 半轮 → 近日点 → 留 → 下合 → 极长视直径 → 留 → 降交点 → 半轮 → 西大距 → 远日点 → 极短视直径 → 上合 → 升交点 → 东大距，周期是116日（水星的会合周期），而水星东大距 → 西大距平均间隔为41天。这次水星西大距，日出时位于东南方天空，与太阳的最大角距为21度，亮度约-0.5等，是今年观测水星的第四次最佳时机。</p><h2 id="小熊座流星雨"><a href="#小熊座流星雨" class="headerlink" title="小熊座流星雨"></a>小熊座流星雨</h2><p>小熊座流星雨（Ursids，00015 URS）往往是全年精彩天象的收官之作，该流星雨的活动期为12月17日至12月26日。天文预报显示，今年该流星雨极大可能出现在12月22日4时53分。</p><p><img src="/images/2018-12/Murahashi1.jpg" alt=""></p><p>小熊座流星雨在1949年和1986年曾出现过两次爆发，但今年没有爆发的预期，届时每小时最大天顶流量为10颗左右，而且极大正好赶上满月，观测条件不是太好。</p><hr><blockquote><p>部分图片来自维基百科，采用CC BY-SA 3.0许可证，作者为Brocken Inaglory以及Brian Murahashi和Jim Albers。部分图片来自Stellarium，该软件为开源软件，采用GPL3.0协议。</p></blockquote><p>拓展阅读：<a href="https://www.skyandtelescope.com/astronomy-news/spot-decembers-ursid-meteors" target="_blank" rel="noopener">Can You Spot December’s Ursid Meteors?</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;即将到来的12月天宇将先后上演『金星最亮』『双子座流星雨极大』『水星西大距』和『小熊座流星雨极大』等多部天象大片，天文爱好者们千万不要错过。&lt;/p&gt;
&lt;h2 id=&quot;火星合海王星&quot;&gt;&lt;a href=&quot;#火星合海王星&quot; class=&quot;headerlink&quot; title=&quot;火星
      
    
    </summary>
    
      <category term="物理" scheme="https://zhangshuqiao.org/categories/%E7%89%A9%E7%90%86/"/>
    
    
      <category term="天文" scheme="https://zhangshuqiao.org/tags/%E5%A4%A9%E6%96%87/"/>
    
  </entry>
  
  <entry>
    <title>Safari顶栏彩虹效果</title>
    <link href="https://zhangshuqiao.org/2018-11/Safari%E9%A1%B6%E6%A0%8F%E5%BD%A9%E8%99%B9%E6%95%88%E6%9E%9C/"/>
    <id>https://zhangshuqiao.org/2018-11/Safari顶栏彩虹效果/</id>
    <published>2018-11-27T05:53:11.000Z</published>
    <updated>2018-12-15T16:55:14.609Z</updated>
    
    <content type="html"><![CDATA[<p>从OS X Yosemite系统开始，Safari浏览器的顶部工具栏加入了类似iOS中的半透明毛玻璃效果。Safari会自动根据页面的颜色来显示工具栏的毛玻璃特效颜色，而通过CSS中的<code>body:before</code>类，我们可以对其进行定制。具体代码如下：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">media</span> screen and (-webkit-min-device-pixel-ratio: <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="selector-tag">body</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">        <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">        <span class="attribute">z-index</span>: <span class="number">2147483647</span>;</span><br><span class="line">        <span class="attribute">position</span>: fixed;</span><br><span class="line">        <span class="attribute">content</span>: <span class="string">""</span>;</span><br><span class="line">        <span class="attribute">display</span>: block;</span><br><span class="line">        <span class="attribute">-webkit-transform</span>: <span class="built_in">translateY</span>(-99.99px);</span><br><span class="line">        <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(124deg,</span><br><span class="line">        #FF0000,</span><br><span class="line">        #FF7F00,</span><br><span class="line">        #FFFF00,</span><br><span class="line">        #7FFF00,</span><br><span class="line">        #00FF00,</span><br><span class="line">        #00FF7F,</span><br><span class="line">        #00FFFF,</span><br><span class="line">        #007FFF,</span><br><span class="line">        #0000FF,</span><br><span class="line">        #7F00FF,</span><br><span class="line">        #FF00FF,</span><br><span class="line">        #FF007F,</span><br><span class="line">        #FF0000);</span><br><span class="line">        <span class="attribute">animation</span>: rainbow <span class="number">15s</span> ease infinite;</span><br><span class="line">        <span class="attribute">background-size</span>: <span class="number">1000%</span> <span class="number">1000%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">keyframes</span> rainbow &#123;</span><br><span class="line">    0% &#123;</span><br><span class="line">        <span class="attribute">background-position</span>: <span class="number">0%</span> <span class="number">80%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    50% &#123;</span><br><span class="line">        <span class="attribute">background-position</span>: <span class="number">100%</span> <span class="number">20%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    100% &#123;</span><br><span class="line">        <span class="attribute">background-position</span>: <span class="number">0%</span> <span class="number">80%</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>将它们添加到页面中的<code>&lt;style&gt;</code>标签内，并在<code>&lt;body&gt;</code>中加入适当的内容。当使用Safari浏览器打开时，<strong>略微向下滚动页面</strong>，便可以看到顶部栏出现炫酷的彩虹效果。快去试试吧！<br><strong>注意：一些老旧浏览器不能正确识别<code>transform</code>，会导致彩色条挡住<code>&lt;body&gt;</code>，<code>-webkit-min-device-pixel-ratio</code>可以防止这一问题。</strong><br>GitHub项目地址：<a href="https://github.com/koole/rainbowsafari" target="_blank" rel="noopener">rainbowsafari</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;从OS X Yosemite系统开始，Safari浏览器的顶部工具栏加入了类似iOS中的半透明毛玻璃效果。Safari会自动根据页面的颜色来显示工具栏的毛玻璃特效颜色，而通过CSS中的&lt;code&gt;body:before&lt;/code&gt;类，我们可以对其进行定制。具体代码如下：&lt;
      
    
    </summary>
    
      <category term="Web开发" scheme="https://zhangshuqiao.org/categories/Web%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="Mac" scheme="https://zhangshuqiao.org/tags/Mac/"/>
    
      <category term="CSS" scheme="https://zhangshuqiao.org/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>国际单位制基本单位的重新定义</title>
    <link href="https://zhangshuqiao.org/2018-11/%E5%9B%BD%E9%99%85%E5%8D%95%E4%BD%8D%E5%88%B6%E5%9F%BA%E6%9C%AC%E5%8D%95%E4%BD%8D%E7%9A%84%E9%87%8D%E6%96%B0%E5%AE%9A%E4%B9%89/"/>
    <id>https://zhangshuqiao.org/2018-11/国际单位制基本单位的重新定义/</id>
    <published>2018-11-22T01:58:01.000Z</published>
    <updated>2019-03-13T15:59:15.181Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>国际单位制以一组基本单位为基础，所有其他单位都是用基本单位建立起来的。麦克斯韦最初提出一致单位制的概念时，列出了三个可用的基本单位：质量、长度及时间单位。之后，吉奥尔吉提倡加入电的基本单位。理论上，电流、电势、电阻、电荷等物理量的单位都可以做基本单位，当选定其中一个做基本单位后，其余的电单位都可以通过物理定律从基本单位推导得出；国际单位制最终选择了使用电流。后期又加入了三个分别量度物质的量、温度及发光强度的基本单位。<br>国际单位制希望其单位定义的基准是源自于对自然的测量。但此单位制于1799在法国被引入时，由当时技术上的限制，因此利用了米原器与千克原器做为米与千克的定义。<br>1960年，米的定义被改写为由特定光源所发出的光波长（后又改为根据真空光速定义），因此米定义的基准也成为了对自然测量的结果。现今，只留下了千克还是以人造的物品做为定义的基准。<br><strong>2018年11月16日，第26届国际计量大会一致通过了新国际单位制基本单位定义的提案。新的定义将于2019年5月20日生效。</strong><br>国际度量衡局提案，除了光速以外，下列所示的四个自然常数也应被定义为确定的数值：</p><ul><li>普朗克常数$h=6.62607015\times10^{−34}(J\cdot s)$</li><li>基本电荷$e=1.602176634\times10^{−19}(C)$</li><li>玻尔兹曼常数$k=1.380649\times10^{−23}(J\cdot K^{−1})$</li><li>阿伏伽德罗常量$N_A=6.02214076\times10^{23}(mol^{−1})$</li></ul><p>这些常数在2006年版的SI指南就已经出现，但在此版本中后三个常数被定义为『由实验所得的常数』，而不是直接的『定义常数』。<br>国际度量衡局也提案，以下这些自然常数的数值应继续保持不变。</p><ul><li>光速$c=299,792,458(m\cdot s^{-1})$</li><li>铯133原子基态超精细能级分裂频率$\Delta\nu(^{133}Cs)_{hfs}=9,192,631,770(Hz)$</li><li>频率为$540\times10^{12}Hz$辐射的发光效率$K_{cd}=683(lm\cdot W^{-1})$</li></ul><p>这是以上七个定义改写为以基本单位表示的形式：</p><ul><li>$\Delta\nu(^{133}Cs)_{hfs}=9,192,631,770(s^{−1})$</li><li>$c=299,792,458(m\cdot s^{−1})$</li><li>$h=6.62607015\times10^{−34}(kg\cdot m^2\cdot s^{−1})$</li><li>$e=1.602176634\times10^{−19}(A\cdot s)$</li><li>$k=1.380649\times10^{−23}(kg\cdot m^2\cdot K^{−1}\cdot s^{−2})$</li><li>$N_A=6.02214076\times1023(mol^{−1})$</li><li>$K_{cd}=683(cd\cdot sr\cdot s^3\cdot kg^{−1}\cdot m^{−2})$</li></ul><p>此外国际度量衡局也要求：</p><ul><li>目前千克的定义应废除并使国际千克原器退休</li><li>目前安培的定义应废除</li><li>目前开尔文的定义应废除</li><li>目前摩尔的定义应修改</li></ul><p>这些改变会影响到基本单位的定义，但对于导出单位的表达形式则不会有所影响。</p><a id="more"></a><h2 id="改变历史"><a href="#改变历史" class="headerlink" title="改变历史"></a>改变历史</h2><p>我们可以回顾国际单位制基本单位定义的改变历史。</p><h3 id="米"><a href="#米" class="headerlink" title="米"></a>米</h3><p>最初（1793年）：从北极至赤道经过巴黎的子午线长度的一千万分之一。（法国政府）<br>过渡（1799年）：国际米原器的长度。<br>过渡（1960年）：氪-86原子在$2p^{10}$和$5d^5$量子能级之间跃迁所发出的电磁波在真空中的波长的1,650,763.73倍。<br>目前（1983年）：光在$\frac{1}{299,792,458}$秒内在真空中行进的距离。</p><h3 id="千克"><a href="#千克" class="headerlink" title="千克"></a>千克</h3><p>最初（1793年）：最初法文名为grave，定义为在冰点下体积为一立方分米的纯水的重量（质量）。（法国政府）<br>目前（1889年）：国际千克原器的质量。<br>未来（2019年）：由精确的普朗克常数$h=6.62607015\times10^{−34}(kg\cdot m^2\cdot s^{−1})$、米和秒所定义。</p><h3 id="秒"><a href="#秒" class="headerlink" title="秒"></a>秒</h3><p>最初（中世纪）：一天时长的86,400分之一。<br>过渡（1956年）：1900年1月0日历书时12时算起的回归年时长的$\frac{1}{31,556,925.9747}$。<br>目前（1967年）：铯-133原子基态的两个超精细能级之间跃迁所对应的辐射周期时长的9,192,631,770倍。</p><h3 id="安培"><a href="#安培" class="headerlink" title="安培"></a>安培</h3><p>最初（1881年）：CGS电磁单位制中电流单位的十分之一。CGS电流单位的定义是，在半径为1厘米、长度为1厘米的圆弧上流通，并在圆心产生1奥斯特电场的电流。（国际电工委员会）<br>目前（1946年）：在真空中相距1米的两根横截面为圆形、粗度可忽略不计的无限长平行直导线，各通上相等的恒定电流，当两根导线之间每米长度所受力为$2\times10^{−7}$牛顿时，各导线上的电流定义为1安培。<br>未来（2019年）：由新的元电荷$e=1.602176634\times10^{−19}(A\cdot s)$和秒所定义。</p><h3 id="开尔文"><a href="#开尔文" class="headerlink" title="开尔文"></a>开尔文</h3><p>最初（1743年）：摄氏温标将0°C和100°C分别定义为水的熔点和沸点。<br>过渡（1954年）：273.16K定义为水的三相点（0.01°C）。<br>目前（1967年）：水的三相点热力学温度的$\frac{1}{273.16}$。<br>未来（2019年）：由新的玻尔兹曼常数$k=1.380649\times10^{−23}(kg\cdot m^2\cdot K^{−1}\cdot s^{−2})$、千克、米和秒所定义。</p><h3 id="摩尔"><a href="#摩尔" class="headerlink" title="摩尔"></a>摩尔</h3><p>最初（1900年）：物质的克数等于其分子量时的数量。（国际原子量委员会）<br>目前（1967年）：物质所含的粒子数量相等于0.012千克碳-12所含的原子数量。<br>未来（2019年）：1摩尔包含$6.02214076×10^{23}$个基本实体，这一数字是新的阿伏伽德罗常数。</p><h3 id="坎德拉"><a href="#坎德拉" class="headerlink" title="坎德拉"></a>坎德拉</h3><p>最初（1946年）：整个辐射体在铂凝固温度下的亮度，定义为60新坎德拉每平方厘米。<br>目前（1979年）：频率为$5.4×10^{14}$赫兹的单色光源在特定方向辐射强度为$\frac{1}{683}W/sr$时的发光强度。</p><h2 id="依赖关系"><a href="#依赖关系" class="headerlink" title="依赖关系"></a>依赖关系</h2><p>由于定义的变化，这些单位之间的依赖关系也发生了改变。</p><p><img src="/images/2018-11/Unit_relations_in_the_old_SI.svg" alt=""><br><img src="/images/2018-11/Unit_relations_in_the_new_SI.svg" alt=""></p><h2 id="不确定度"><a href="#不确定度" class="headerlink" title="不确定度"></a>不确定度</h2><p>同样，由于定义的变化，一些物理量的不确定度也发生了改变。例如，真空磁导率$\mu_0$将不再具有定义值$4\pi\times10^{-7}m\cdot kg\cdot s^{-2}\cdot A^{-2}$，水的三相点温度也不再严格地等于273.16K。下表给出了它们在改动后的影响：</p><table><thead><tr><th>Constant</th><th>Symbol</th><th>Relation to directly measured and fixed constants (Previous)</th><th>Significant factor(s) in uncertainty (Previous)</th><th>Relative uncertainty (Previous)</th><th>Relation to directly measured and fixed constants (2019)</th><th>Significant factor(s) in uncertainty (2019)</th><th>Relative uncertainty (2019)</th></tr></thead><tbody><tr><td>Mass of IPK</td><td>$m(\mathcal{K})$</td><td>1&nbsp;kg</td><td>None</td><td>Exact</td><td>$m(\mathcal{K})$</td><td>$m(\mathcal{K})$</td><td>$1.2 \times 10^{-8} = u_\text{r}(m(\mathcal{K}))$</td></tr><tr><td>Planck constant</td><td>$h$</td><td>$\frac{8 \alpha}{c \mu_0 K_\text{J}^2}$</td><td>$K_\text{J}^2$</td><td>$1.2 \times 10^{-8} \approx 2 u_\text{r}(K_\text{J})$</td><td>$6.62607015\times10^{-34} kg\cdot m^2\cdot s^{−1}$</td><td>None</td><td>Exact</td></tr><tr><td>Josephson constant</td><td>$K_\text{J}$</td><td>$K_\text{J}$</td><td>$K_\text{J}$</td><td>$6.1 \times 10^{-9} = u_\text{r}(K_\text{J})$</td><td>$\frac{2 e}{h}$</td><td>None</td><td>Exact</td></tr><tr><td>Von Klitzing constant</td><td>$R_\text{K}$</td><td>$\frac{c \mu_0}{2 \alpha}$</td><td>$\alpha$</td><td>$2.3 \times 10^{-10} = u_\text{r}(\alpha)$</td><td>$\frac{h}{e^2}$</td><td>None</td><td>Exact</td></tr><tr><td>Elementary charge</td><td>$e$</td><td>$\frac{4 \alpha}{c \mu_0 K_\text{J}}$</td><td>$K_\text{J}$</td><td>$6.1 \times 10^{-9} \approx u_\text{r}(K_\text{J})$</td><td>$1.602176634\times10^{-19} A\cdot s$</td><td>None</td><td>Exact</td></tr><tr><td>Magnetic constant</td><td>$\mu_0$</td><td>$4\pi\times10^{-7} m\cdot kg\cdot s^{−2}\cdot A^{−2} $</td><td>None</td><td>Exact</td><td>$\frac{2 h \alpha}{c e^2}$</td><td>$\alpha$</td><td>$2.3 \times 10^{-10} = u_\text{r}(\alpha)$</td></tr><tr><td>Vacuum permittivity</td><td>$\varepsilon_0$</td><td>$\frac{1}{c^2 \mu_0}$</td><td>None</td><td>Exact</td><td>$\frac{e^2}{2 h c \alpha}$</td><td>$\alpha$</td><td>$2.3 \times 10^{-10} = u_\text{r}(\alpha)$</td></tr><tr><td>Impedance of free space</td><td>$Z_0$</td><td>$c \mu_0$</td><td>None</td><td>Exact</td><td>$\frac{2 h \alpha}{e^2}$</td><td>$\alpha$</td><td>$2.3 \times 10^{-10} = u_\text{r}(\alpha)$</td></tr><tr><td>Electron mass</td><td>$m_\text{e}$</td><td>$\frac{16 R_{\infty}}{c^2 \alpha \mu_0 K_\text{J}^2}$</td><td>$K_\text{J}^2$</td><td>$1.2 \times 10^{-8} \approx 2 u_\text{r}(K_\text{J})$</td><td>$\frac{2 h R_{\infty}}{c \alpha^2}$</td><td>$\alpha^2$</td><td>$4.7 \times 10^{-10} \approx 2 u_\text{r}(\alpha)$</td></tr><tr><td>Electron molar mass</td><td>$M(\text{e})$</td><td>$A_\text{r}(\text{e}) M_\text{u}$</td><td>$A_\text{r}(\text{e})$</td><td>$2.9 \times 10^{-11} = u_\text{r}(A_\text{r}(\text{e}))$</td><td>$\frac{2 h R_{\infty} N_\text{A}}{c \alpha^2}$</td><td>$\alpha^2$</td><td>$4.7 \times 10^{-10} \approx 2 u_\text{r}(\alpha)$</td></tr><tr><td>Unified atomic mass unit or dalton</td><td>\begin{align*}m_u &amp; = 1u \\ &amp; = 1Da\end{align*}</td><td>$\frac{16 R_{\infty}}{c^2 \alpha \mu_0 K_\text{J}^2 A_\text{r}(\text{e})}$</td><td>$K_\text{J}^2$</td><td>$1.2 \times 10^{-8} \approx 2 u_\text{r}(K_\text{J})$</td><td>$\frac{2 h R_{\infty}}{c \alpha^2 A_\text{r}(\text{e})}$</td><td>$\alpha^2$</td><td>$4.7 \times 10^{-10} \approx 2 u_\text{r}(\alpha)$</td></tr><tr><td>Molar mass constant</td><td>$M_\text{u}$</td><td>$0.001kg\cdot mol^{−1}$</td><td>None</td><td>Exact</td><td>$\frac{2 h R_{\infty} N_\text{A}}{c \alpha^2 A_\text{r}(\text{e})}$</td><td>$\alpha^2$</td><td>$4.7 \times 10^{-10} \approx 2 u_\text{r}(\alpha)$</td></tr><tr><td>Avogadro constant</td><td>$N_\text{A}$</td><td>$\frac{c^2 \alpha \mu_0 K_\text{J}^2 A_\text{r}(\text{e}) M_\text{u}}{16 R_{\infty}}$</td><td>$K_\text{J}^2$</td><td>$1.2 \times 10^{-8} \approx 2 u_\text{r}(K_\text{J})$</td><td>$6.02214076\times10^{23} mol^{−1}$</td><td>None</td><td>Exact</td></tr><tr><td>Atomic mass of carbon-12</td><td>$m(^{12}\text{C})$</td><td>$\frac{192 R_{\infty}}{c^2 \alpha \mu_0 K_\text{J}^2 A_\text{r}(\text{e})}$</td><td>$K_\text{J}^2$</td><td>$1.2 \times 10^{-8} \approx 2 u_\text{r}(K_\text{J})$</td><td>$\frac{24 h R_{\infty}}{c \alpha^2 A_\text{r}(\text{e})}$</td><td>$\alpha^2$</td><td>$4.7 \times 10^{-10} \approx 2 u_\text{r}(\alpha)$</td></tr><tr><td>Molar mass of carbon-12</td><td>$M(^{12}\text{C})$</td><td>$0.012kg\cdot mol^{−1}$</td><td>None</td><td>Exact</td><td>$\frac{24 h R_{\infty} N_\text{A}}{c \alpha^2 A_\text{r}(\text{e})}$</td><td>$\alpha^2$</td><td>$4.7 \times 10^{-10} \approx 2 u_\text{r}(\alpha)$</td></tr><tr><td>Faraday constant</td><td>$F$</td><td>$\frac{c \alpha^2 K_\text{J} A_\text{r}(\text{e}) M_\text{u}}{4 R_{\infty}}$</td><td>$K_\text{J}, \alpha^2$</td><td>$6.2 \times 10^{-9} \approx u_\text{r}(K_\text{J})$</td><td>$e N_\text{A}$</td><td>None</td><td>Exact</td></tr><tr><td>Temperature of triple point of water</td><td>$T_\text{TPW}$</td><td>273.16 K</td><td>None</td><td>Exact</td><td>$T_\text{TPW}$</td><td>$T_\text{TPW}$</td><td>$5.7 \times 10^{-7} = u_\text{r}(T_\text{TPW})$</td></tr><tr><td>Molar gas constant</td><td>$R$</td><td>$R$</td><td>$R$</td><td>$5.7 \times 10^{-7} = u_\text{r}(R)$</td><td>$k N_\text{A}$</td><td>None</td><td>Exact</td></tr><tr><td>Boltzmann constant</td><td>$k$</td><td>$\frac{16 R R_{\infty}}{c^2 \alpha \mu_0 K_\text{J}^2 A_\text{r}(\text{e}) M_\text{u}}$</td><td>$R$</td><td>$5.7 \times 10^{-7} \approx u_\text{r}(R)$</td><td>$1.380649\times10^{-23} kg\cdot m^2\cdot K^{−1} \cdot s^{−2}$</td><td>None</td><td>Exact</td></tr><tr><td>Stefan–Boltzmann constant</td><td>$\sigma$</td><td>$\frac{256 \pi^5 R^4 R_{\infty}^4}{15 c^7 \alpha^7 \mu_0 K_\text{J}^2 A_\text{r}(\text{e})^4 M_\text{u}^4}$</td><td>$R^4$</td><td>$2.3 \times 10^{-6} \approx 4 u_\text{r}(R)$</td><td>$\frac{2 \pi^5 k^4}{15 h^3 c^2}$</td><td>None</td><td>Exact</td></tr></tbody></table><p>注：其中，$c$为光速（speed of light），$\alpha$为精细结构常数（fine-structure constant），$R_\infty$为里德伯常量（Rydberg constant）。</p><hr><p>参考文章：<br><a href="https://en.wikipedia.org/wiki/2019_redefinition_of_SI_base_units" target="_blank" rel="noopener">Redefinition of SI base units - 维基百科</a><br><a href="https://en.wikipedia.org/wiki/International_System_of_Units" target="_blank" rel="noopener">国际单位制 - 维基百科</a></p><p>拓展阅读：<br><a href="https://mp.weixin.qq.com/s/bYIHtP3B33rPAHYWIvNatQ" target="_blank" rel="noopener">刚刚，『千克』被重新定义！大K从此成为历史</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;国际单位制以一组基本单位为基础，所有其他单位都是用基本单位建立起来的。麦克斯韦最初提出一致单位制的概念时，列出了三个可用的基本单位：质量、长度及时间单位。之后，吉奥尔吉提倡加入电的基本单位。理论上，电流、电势、电阻、电荷等物理量的单位都可以做基本单位，当选定其中一个做基本单位后，其余的电单位都可以通过物理定律从基本单位推导得出；国际单位制最终选择了使用电流。后期又加入了三个分别量度物质的量、温度及发光强度的基本单位。&lt;br&gt;国际单位制希望其单位定义的基准是源自于对自然的测量。但此单位制于1799在法国被引入时，由当时技术上的限制，因此利用了米原器与千克原器做为米与千克的定义。&lt;br&gt;1960年，米的定义被改写为由特定光源所发出的光波长（后又改为根据真空光速定义），因此米定义的基准也成为了对自然测量的结果。现今，只留下了千克还是以人造的物品做为定义的基准。&lt;br&gt;&lt;strong&gt;2018年11月16日，第26届国际计量大会一致通过了新国际单位制基本单位定义的提案。新的定义将于2019年5月20日生效。&lt;/strong&gt;&lt;br&gt;国际度量衡局提案，除了光速以外，下列所示的四个自然常数也应被定义为确定的数值：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;普朗克常数$h=6.62607015\times10^{−34}(J\cdot s)$&lt;/li&gt;
&lt;li&gt;基本电荷$e=1.602176634\times10^{−19}(C)$&lt;/li&gt;
&lt;li&gt;玻尔兹曼常数$k=1.380649\times10^{−23}(J\cdot K^{−1})$&lt;/li&gt;
&lt;li&gt;阿伏伽德罗常量$N_A=6.02214076\times10^{23}(mol^{−1})$&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这些常数在2006年版的SI指南就已经出现，但在此版本中后三个常数被定义为『由实验所得的常数』，而不是直接的『定义常数』。&lt;br&gt;国际度量衡局也提案，以下这些自然常数的数值应继续保持不变。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;光速$c=299,792,458(m\cdot s^{-1})$&lt;/li&gt;
&lt;li&gt;铯133原子基态超精细能级分裂频率$\Delta\nu(^{133}Cs)_{hfs}=9,192,631,770(Hz)$&lt;/li&gt;
&lt;li&gt;频率为$540\times10^{12}Hz$辐射的发光效率$K_{cd}=683(lm\cdot W^{-1})$&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这是以上七个定义改写为以基本单位表示的形式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;$\Delta\nu(^{133}Cs)_{hfs}=9,192,631,770(s^{−1})$&lt;/li&gt;
&lt;li&gt;$c=299,792,458(m\cdot s^{−1})$&lt;/li&gt;
&lt;li&gt;$h=6.62607015\times10^{−34}(kg\cdot m^2\cdot s^{−1})$&lt;/li&gt;
&lt;li&gt;$e=1.602176634\times10^{−19}(A\cdot s)$&lt;/li&gt;
&lt;li&gt;$k=1.380649\times10^{−23}(kg\cdot m^2\cdot K^{−1}\cdot s^{−2})$&lt;/li&gt;
&lt;li&gt;$N_A=6.02214076\times1023(mol^{−1})$&lt;/li&gt;
&lt;li&gt;$K_{cd}=683(cd\cdot sr\cdot s^3\cdot kg^{−1}\cdot m^{−2})$&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;此外国际度量衡局也要求：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;目前千克的定义应废除并使国际千克原器退休&lt;/li&gt;
&lt;li&gt;目前安培的定义应废除&lt;/li&gt;
&lt;li&gt;目前开尔文的定义应废除&lt;/li&gt;
&lt;li&gt;目前摩尔的定义应修改&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这些改变会影响到基本单位的定义，但对于导出单位的表达形式则不会有所影响。&lt;/p&gt;
    
    </summary>
    
      <category term="物理" scheme="https://zhangshuqiao.org/categories/%E7%89%A9%E7%90%86/"/>
    
    
  </entry>
  
  <entry>
    <title>在网页上实现3D Touch效果</title>
    <link href="https://zhangshuqiao.org/2018-11/%E5%9C%A8%E7%BD%91%E9%A1%B5%E4%B8%8A%E5%AE%9E%E7%8E%B03D%20Touch%E6%95%88%E6%9E%9C/"/>
    <id>https://zhangshuqiao.org/2018-11/在网页上实现3D Touch效果/</id>
    <published>2018-11-18T12:52:12.000Z</published>
    <updated>2019-02-12T03:44:08.371Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/2018-11/3d_touch_cover_.jpg" alt=""></p><p>2016年9月14日凌晨，iOS 10正式版开始向用户推送更新，而iOS 10搭载的Safari10亦带来了不少新特性，其中就有3D Touch事件的支持（官方文档<a href="https://developer.apple.com/library/prerelease/content/releasenotes/General/WhatsNewInSafari/Articles/Safari_10_0.html" target="_blank" rel="noopener">《What’s New in Safari 10》</a>）。</p><h2 id="Force-Touch与3D-Touch"><a href="#Force-Touch与3D-Touch" class="headerlink" title="Force Touch与3D Touch"></a>Force Touch与3D Touch</h2><p>说到3D Touch不能不提与之相似的Force Touch。Force Touch是苹果公司在2014年9月公布的一项压力敏感屏幕技术，最早用于Apple Watch，可识别轻点、轻按两种操作。随后Force Touch于2015年9月在iPhone 6S上得到改进并更名为3D Touch，提供了更高灵敏度的触控力度识别、及更强的触感反馈，支持轻点、轻按及重按三个维度。</p><p>支持3D Touch的设备，目前有iPhone 6S、iPhone 6S Plus、iPhone 7以及iPhone 7 Plus（注：截止2018年，还要加上iPhone 8和iPhone X等）。这是后文的硬件要求。</p><h2 id="感受3D-Touch"><a href="#感受3D-Touch" class="headerlink" title="感受3D Touch"></a>感受3D Touch</h2><p>3D Touch最为典型的交互有Quick Actions和Peek and Pop两种。在APP图标上重按呼出一组快捷操作菜单，这即是典型的Quick Actions：</p><p><img src="/images/2018-11/quick_actions.jpg" alt=""></p><p>而使用Peek and Pop则可以快速地对内容进行预览，以及后续的其他操作：</p><p><img src="/images/2018-11/peek_and_pop.jpg" alt=""></p><p>如上图所示，在系统的邮件APP中，以一定的力度按压邮件列表中的某一项，会触发Peek弹出一个内容预览窗口（在Peek状态下上滑还能触发Quick Actions调出一些快捷操作项哦），如果继续加大按压力度，则会触发Pop进入邮件内容界面，这整个过程就称之为Peek and Pop。</p><p>除了邮件APP以外，信息、照片等多个系统APP以及一些第三方APP（如微信、Facebook、Twitter等）也都很好的支持了Peek and Pop这种3D Touch交互形式。</p><h2 id="网页中的3D-Touch"><a href="#网页中的3D-Touch" class="headerlink" title="网页中的3D Touch"></a>网页中的3D Touch</h2><p>要在网页中实现3D Touch，需要用到以下两个知识点：</p><ul><li><p>touch.force<br>在touch对象中包含有一个名为<code>force</code>的只读属性，它的取值从0到1，表示的是触碰点的按压力度，0表示没有检测到压力，而1则是设备能识别出的最大压力。</p></li><li><p>touchforcechange<br><code>touchforcechange</code>是Safari 10新增的事件，该事件会在按压力度改变时被触发。</p></li></ul><p>（注：在MacOS Safari上也有与之对应的<code>webkitmouseforcechanged</code>事件，该事件会在支持Force Touch的Trackpad上反应出按压力度值force的变化，但本文仅讨论手机设备的情况）</p><h2 id="实现3D-Touch效果"><a href="#实现3D-Touch效果" class="headerlink" title="实现3D Touch效果"></a>实现3D Touch效果</h2><p>要实现3D Touch效果，关键在于实时地获取touch.force的值。而由于网页上的3D Touch很大程度上受限于设备及浏览器的支持情况，因此我们划分以下3种情况，分别来看看要如何实现：</p><ul><li><p>支持3D Touch且升级到了iOS 10的设备<br>在这种最为理想的情况下，只需要监听touchforcechange事件即可获取到force的当前值，将force值的变化以适当的形式反馈在界面上以实现3D Touch效果。</p></li><li><p>支持3D Touch但系统版本低于iOS 10的设备<br>这种情况虽然无法监听touchforcechange事件，但Touch对象的force属性仍然可以反应出正确的按压力度，可以巧妙地设置一个定时器，以轮询的方式获取force的当前值。</p></li><li><p>不支持3D Touch的设备<br>这种情况下touch.force的取值始终为0，虽然可以用长按的交互形式来代替，但建议还是以优雅降级的方式，索性就不处理了吧。</p></li></ul><h2 id="一个3D-Touch的例子"><a href="#一个3D-Touch的例子" class="headerlink" title="一个3D Touch的例子"></a>一个3D Touch的例子</h2><p>看到这里你肯定想说”Shut up and show me the code…”。好的，那我们来看一个例子，在这个示例页面，用支持3D Touch的设备按压蓝色按钮可以将树懒兄逗笑哦，嘿嘿嘿～</p><a id="more"></a><p><img src="/images/2018-11/demo.png" alt=""></p><p>你可扫描以上二维码，或<a href="http://jdc.jd.com/demo/3d-touch" target="_blank" rel="noopener">戳我进行预览</a>，<strong>注意请使用iOS Safari浏览器进行访问！使用iOS Safari浏览器！！使用iOS Safari浏览器！！！</strong>重要的事情要说三遍，因为目前微信WebView并不支持3D Touch。</p><p>实现思路其实比较简单，根据刚刚说到的知识，我们分别监听touchforcechange、touchstart、touchend、touchcancel事件：</p><ul><li>在touchstart事件中，启动一个定时器轮询地去获取touch.force的值；</li><li>在touchforcechange事件中获取当前touch.force的值，并清除touchstart事件中设置的定时器，因为支持touchforcechange事件的话就没必要轮询了；</li><li>在touchend及touchcancel事件中把touch.force重置为0，并清除定时器。</li></ul><p>而树懒兄大笑的动画则用的是以下这张雪碧图，根据当前touch.force值来设置background-position以显示对应的动画帧来实现的。</p><p><img src="/images/2018-11/sloth.png" alt=""></p><p>你可以访问这个<a href="https://github.com/hihuimin/3d-touch" target="_blank" rel="noopener">Github项目</a>来查看源码，核心代码位于ThreeDTouch.js，该文件封装了一个名为ThreeDTouch的类，事例化时传入一个DOM对象即可在callback中获取到按压力度值的变化。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 3D Touch 事件处理器，传入要监听的 DOM 对象，在 callback 回调中获取当前 force 值</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param &#123; HTMLElement &#125; el - 要监听的 DOM 对象</span></span><br><span class="line"><span class="comment"> * @param &#123; Function &#125; callback - 带有 force 值的回调函数</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ThreeDTouch</span>(<span class="params">el, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.el = el</span><br><span class="line">    <span class="keyword">this</span>.callback = callback</span><br><span class="line">    <span class="keyword">this</span>._bindEvents()</span><br><span class="line">&#125;</span><br><span class="line">ThreeDTouch.prototype = &#123;</span><br><span class="line">    <span class="comment">//绑定相关 touch 事件</span></span><br><span class="line">    _bindEvents: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> events = [<span class="string">'touchforcechange'</span>, <span class="string">'touchstart'</span>, <span class="string">'touchend'</span>, <span class="string">'touchcancel'</span>]</span><br><span class="line">        events.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.el.addEventListener(event, <span class="keyword">this</span>, <span class="literal">false</span>)</span><br><span class="line">        &#125;.bind(<span class="keyword">this</span>))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//分派 touch 事件</span></span><br><span class="line">    handleEvent: <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (ev.type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'touchforcechange'</span>:</span><br><span class="line">                <span class="keyword">this</span>._touchForceDidChange(ev)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">'touchstart'</span>:</span><br><span class="line">                <span class="keyword">this</span>._touchDidStart(ev)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">case</span> <span class="string">'touchend'</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'touchcancel'</span>:</span><br><span class="line">                <span class="keyword">this</span>._touchDidEnd(ev)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//force 值改变时</span></span><br><span class="line">    _touchForceDidChange: <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> force = ev.touches[<span class="number">0</span>].force</span><br><span class="line">        <span class="keyword">this</span>.callback(force)</span><br><span class="line">        clearTimeout(<span class="keyword">this</span>.timeoutId) <span class="comment">//支持 touchforcechange 的话则取消轮询</span></span><br><span class="line">    &#125;,</span><br><span class="line">    _touchDidStart: <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> touch = ev.touches[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">this</span>._checkForce(touch)</span><br><span class="line">    &#125;,</span><br><span class="line">    _touchDidEnd: <span class="function"><span class="keyword">function</span>(<span class="params">ev</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.callback(<span class="number">0</span>)</span><br><span class="line">        clearTimeout(<span class="keyword">this</span>.timeoutId)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//轮询地获取 force 值</span></span><br><span class="line">    _checkForce: <span class="function"><span class="keyword">function</span>(<span class="params">touch</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.callback(touch.force)</span><br><span class="line">        <span class="keyword">this</span>.timeoutId = setTimeout(<span class="keyword">this</span>._checkForce.bind(<span class="keyword">this</span>, touch), <span class="number">16</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>本文转载自：<a href="https://aotu.io/notes/2016/09/28/3d-touch" target="_blank" rel="noopener">在网页上实现 3D Touch 效果 - 凹凸实验室</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/images/2018-11/3d_touch_cover_.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;2016年9月14日凌晨，iOS 10正式版开始向用户推送更新，而iOS 10搭载的Safari10亦带来了不少新特性，其中就有3D Touch事件的支持（官方文档&lt;a href=&quot;https://developer.apple.com/library/prerelease/content/releasenotes/General/WhatsNewInSafari/Articles/Safari_10_0.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;《What’s New in Safari 10》&lt;/a&gt;）。&lt;/p&gt;
&lt;h2 id=&quot;Force-Touch与3D-Touch&quot;&gt;&lt;a href=&quot;#Force-Touch与3D-Touch&quot; class=&quot;headerlink&quot; title=&quot;Force Touch与3D Touch&quot;&gt;&lt;/a&gt;Force Touch与3D Touch&lt;/h2&gt;&lt;p&gt;说到3D Touch不能不提与之相似的Force Touch。Force Touch是苹果公司在2014年9月公布的一项压力敏感屏幕技术，最早用于Apple Watch，可识别轻点、轻按两种操作。随后Force Touch于2015年9月在iPhone 6S上得到改进并更名为3D Touch，提供了更高灵敏度的触控力度识别、及更强的触感反馈，支持轻点、轻按及重按三个维度。&lt;/p&gt;
&lt;p&gt;支持3D Touch的设备，目前有iPhone 6S、iPhone 6S Plus、iPhone 7以及iPhone 7 Plus（注：截止2018年，还要加上iPhone 8和iPhone X等）。这是后文的硬件要求。&lt;/p&gt;
&lt;h2 id=&quot;感受3D-Touch&quot;&gt;&lt;a href=&quot;#感受3D-Touch&quot; class=&quot;headerlink&quot; title=&quot;感受3D Touch&quot;&gt;&lt;/a&gt;感受3D Touch&lt;/h2&gt;&lt;p&gt;3D Touch最为典型的交互有Quick Actions和Peek and Pop两种。在APP图标上重按呼出一组快捷操作菜单，这即是典型的Quick Actions：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2018-11/quick_actions.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;而使用Peek and Pop则可以快速地对内容进行预览，以及后续的其他操作：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/2018-11/peek_and_pop.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;如上图所示，在系统的邮件APP中，以一定的力度按压邮件列表中的某一项，会触发Peek弹出一个内容预览窗口（在Peek状态下上滑还能触发Quick Actions调出一些快捷操作项哦），如果继续加大按压力度，则会触发Pop进入邮件内容界面，这整个过程就称之为Peek and Pop。&lt;/p&gt;
&lt;p&gt;除了邮件APP以外，信息、照片等多个系统APP以及一些第三方APP（如微信、Facebook、Twitter等）也都很好的支持了Peek and Pop这种3D Touch交互形式。&lt;/p&gt;
&lt;h2 id=&quot;网页中的3D-Touch&quot;&gt;&lt;a href=&quot;#网页中的3D-Touch&quot; class=&quot;headerlink&quot; title=&quot;网页中的3D Touch&quot;&gt;&lt;/a&gt;网页中的3D Touch&lt;/h2&gt;&lt;p&gt;要在网页中实现3D Touch，需要用到以下两个知识点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;touch.force&lt;br&gt;在touch对象中包含有一个名为&lt;code&gt;force&lt;/code&gt;的只读属性，它的取值从0到1，表示的是触碰点的按压力度，0表示没有检测到压力，而1则是设备能识别出的最大压力。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;touchforcechange&lt;br&gt;&lt;code&gt;touchforcechange&lt;/code&gt;是Safari 10新增的事件，该事件会在按压力度改变时被触发。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;（注：在MacOS Safari上也有与之对应的&lt;code&gt;webkitmouseforcechanged&lt;/code&gt;事件，该事件会在支持Force Touch的Trackpad上反应出按压力度值force的变化，但本文仅讨论手机设备的情况）&lt;/p&gt;
&lt;h2 id=&quot;实现3D-Touch效果&quot;&gt;&lt;a href=&quot;#实现3D-Touch效果&quot; class=&quot;headerlink&quot; title=&quot;实现3D Touch效果&quot;&gt;&lt;/a&gt;实现3D Touch效果&lt;/h2&gt;&lt;p&gt;要实现3D Touch效果，关键在于实时地获取touch.force的值。而由于网页上的3D Touch很大程度上受限于设备及浏览器的支持情况，因此我们划分以下3种情况，分别来看看要如何实现：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;支持3D Touch且升级到了iOS 10的设备&lt;br&gt;在这种最为理想的情况下，只需要监听touchforcechange事件即可获取到force的当前值，将force值的变化以适当的形式反馈在界面上以实现3D Touch效果。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;支持3D Touch但系统版本低于iOS 10的设备&lt;br&gt;这种情况虽然无法监听touchforcechange事件，但Touch对象的force属性仍然可以反应出正确的按压力度，可以巧妙地设置一个定时器，以轮询的方式获取force的当前值。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;不支持3D Touch的设备&lt;br&gt;这种情况下touch.force的取值始终为0，虽然可以用长按的交互形式来代替，但建议还是以优雅降级的方式，索性就不处理了吧。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;一个3D-Touch的例子&quot;&gt;&lt;a href=&quot;#一个3D-Touch的例子&quot; class=&quot;headerlink&quot; title=&quot;一个3D Touch的例子&quot;&gt;&lt;/a&gt;一个3D Touch的例子&lt;/h2&gt;&lt;p&gt;看到这里你肯定想说”Shut up and show me the code…”。好的，那我们来看一个例子，在这个示例页面，用支持3D Touch的设备按压蓝色按钮可以将树懒兄逗笑哦，嘿嘿嘿～&lt;/p&gt;
    
    </summary>
    
      <category term="Web开发" scheme="https://zhangshuqiao.org/categories/Web%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="JavaScript" scheme="https://zhangshuqiao.org/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>使用示波器播放Bad Apple!!</title>
    <link href="https://zhangshuqiao.org/2018-11/%E4%BD%BF%E7%94%A8%E7%A4%BA%E6%B3%A2%E5%99%A8%E6%92%AD%E6%94%BEBad%20Apple!!/"/>
    <id>https://zhangshuqiao.org/2018-11/使用示波器播放Bad Apple!!/</id>
    <published>2018-11-14T02:09:01.000Z</published>
    <updated>2019-02-23T10:44:29.756Z</updated>
    
    <content type="html"><![CDATA[<p>本视频于某次物理竞赛集训时拍摄于华中科技大学，音频为后期加上。<br>为了对上音轨，前后各有一段黑屏，这是feature而非bug。敬请欣赏。</p><video src="/files/badapple.mp4" preload="metadata" controls playsinline="" poster="">Sorry, your browser does not support the video tag.</video>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本视频于某次物理竞赛集训时拍摄于华中科技大学，音频为后期加上。&lt;br&gt;为了对上音轨，前后各有一段黑屏，这是feature而非bug。敬请欣赏。&lt;/p&gt;
&lt;video src=&quot;/files/badapple.mp4&quot; preload=&quot;metadata&quot; controls 
      
    
    </summary>
    
      <category term="物理" scheme="https://zhangshuqiao.org/categories/%E7%89%A9%E7%90%86/"/>
    
    
  </entry>
  
</feed>
